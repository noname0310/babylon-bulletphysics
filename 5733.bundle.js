"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[5733],{5733:(e,i,r)=>{r.d(i,{F:()=>o});class n{_runtime;_ptr;_rigidBodyReferences;_rigidBodyBundleReferences;_rigidBodyGlobalReferences;_rigidBodyBundleGlobalReferences;_rigidBodyShadowReferences;_rigidBodyBundleShadowReferences;_constraintReferences;_referenceCount;constructor(e,i){this._runtime=e,this._ptr=i,this._rigidBodyReferences=new Map,this._rigidBodyBundleReferences=new Map,this._rigidBodyGlobalReferences=new Set,this._rigidBodyBundleGlobalReferences=new Set,this._rigidBodyShadowReferences=new Map,this._rigidBodyBundleShadowReferences=new Map,this._constraintReferences=new Set,this._referenceCount=0}dispose(e){if(this._referenceCount>0)throw new Error("Cannot dispose physics world while it still has references");if(0!==this._ptr){if(!e){const e=this._runtime.deref();void 0!==e&&(e.lock.wait(),e.wasmInstance.destroyMultiPhysicsWorld(this._ptr))}this._ptr=0;for(const[e,i]of this._rigidBodyReferences)e.setWorldReference(null);this._rigidBodyReferences.clear();for(const[e,i]of this._rigidBodyBundleReferences)e.setWorldReference(null);this._rigidBodyBundleReferences.clear();for(const e of this._rigidBodyGlobalReferences)e.removeReference();this._rigidBodyGlobalReferences.clear();for(const e of this._rigidBodyBundleGlobalReferences)e.removeReference();this._rigidBodyBundleGlobalReferences.clear();for(const e of this._rigidBodyShadowReferences.values())for(const i of e)i.removeReference();this._rigidBodyShadowReferences.clear();for(const e of this._rigidBodyBundleShadowReferences.values())for(const i of e)i.removeReference();this._rigidBodyBundleShadowReferences.clear();for(const e of this._constraintReferences)e.setWorldReference(null);this._constraintReferences.clear()}}get ptr(){return this._ptr}addReference(){this._referenceCount+=1}removeReference(){this._referenceCount-=1}addRigidBodyReference(e,i){if(this._rigidBodyGlobalReferences.has(e))throw new Error("Rigid body is already added to the world as a global reference");const r=this._rigidBodyShadowReferences.get(i);if(void 0!==r&&r.has(e))throw new Error("Rigid body is already added to the world as a shadow reference");return!this._rigidBodyReferences.has(e)&&(e.setWorldReference(this),this._rigidBodyReferences.set(e,i),!0)}removeRigidBodyReference(e){return!!this._rigidBodyReferences.delete(e)&&(e.setWorldReference(null),!0)}addRigidBodyBundleReference(e,i){if(this._rigidBodyBundleGlobalReferences.has(e))throw new Error("Rigid body bundle is already added to the world as a global reference");const r=this._rigidBodyBundleShadowReferences.get(i);if(void 0!==r&&r.has(e))throw new Error("Rigid body bundle is already added to the world as a shadow reference");return!this._rigidBodyBundleReferences.has(e)&&(e.setWorldReference(this),this._rigidBodyBundleReferences.set(e,i),!0)}removeRigidBodyBundleReference(e){return!!this._rigidBodyBundleReferences.delete(e)&&(e.setWorldReference(null),!0)}addRigidBodyGlobalReference(e){if(null!==e.getWorldReference())throw new Error("Rigid body is already added to the world as a strong reference");return!this._rigidBodyGlobalReferences.has(e)&&(e.addReference(),this._rigidBodyGlobalReferences.add(e),!0)}removeRigidBodyGlobalReference(e){return!!this._rigidBodyGlobalReferences.delete(e)&&(e.removeReference(),!0)}addRigidBodyBundleGlobalReference(e){if(null!==e.getWorldReference())throw new Error("Rigid body bundle is already added to the world as a strong reference");return!this._rigidBodyBundleGlobalReferences.has(e)&&(e.addReference(),this._rigidBodyBundleGlobalReferences.add(e),!0)}removeRigidBodyBundleGlobalReference(e){return!!this._rigidBodyBundleGlobalReferences.delete(e)&&(e.removeReference(),!0)}addRigidBodyShadowReference(e,i){const r=this._rigidBodyReferences.get(e);if(void 0!==r&&r===i)return!1;if(this._rigidBodyGlobalReferences.has(e))throw new Error("Rigid body is already added to the world as a global reference");let n=this._rigidBodyShadowReferences.get(i);return void 0===n&&(n=new Set,this._rigidBodyShadowReferences.set(i,n)),!n.has(e)&&(e.addReference(),n.add(e),!0)}removeRigidBodyShadowReference(e,i){const r=this._rigidBodyShadowReferences.get(i);return!(void 0===r||!r.delete(e)||(0===r.size&&this._rigidBodyShadowReferences.delete(i),e.removeReference(),0))}addRigidBodyBundleShadowReference(e,i){const r=this._rigidBodyBundleReferences.get(e);if(void 0!==r&&r===i)return!1;if(this._rigidBodyBundleGlobalReferences.has(e))throw new Error("Rigid body bundle is already added to the world as a global reference");let n=this._rigidBodyBundleShadowReferences.get(i);return void 0===n&&(n=new Set,this._rigidBodyBundleShadowReferences.set(i,n)),!n.has(e)&&(e.addReference(),n.add(e),!0)}removeRigidBodyBundleShadowReference(e,i){const r=this._rigidBodyBundleShadowReferences.get(i);return!(void 0===r||!r.delete(e)||(0===r.size&&this._rigidBodyBundleShadowReferences.delete(i),e.removeReference(),0))}addConstraintReference(e){return!this._constraintReferences.has(e)&&(e.setWorldReference(this),this._constraintReferences.add(e),!0)}removeConstraintReference(e){return!!this._constraintReferences.delete(e)&&(e.setWorldReference(null),!0)}}function t(e){e.dispose(!1)}const d=new WeakMap;class o{_runtime;_inner;_fromPointer;constructor(e,i){if(this._runtime=e,"boolean"==typeof i){const r=e.wasmInstance.createMultiPhysicsWorld(i);this._inner=new n(new WeakRef(e),r);let o=d.get(e.wasmInstance);void 0===o&&(o=new FinalizationRegistry(t),d.set(e.wasmInstance,o)),o.register(this,this._inner,this),this._fromPointer=!1}else this._inner=new n(new WeakRef(e),i),this._fromPointer=!0}dispose(){if(0!==this._inner.ptr&&(this._inner.dispose(this._fromPointer),!this._fromPointer)){const e=d.get(this._runtime.wasmInstance);e?.unregister(this)}}get ptr(){return this._inner.ptr}addReference(){this._inner.addReference()}removeReference(){this._inner.removeReference()}_nullCheck(){if(0===this._inner.ptr)throw new Error("Cannot access disposed physics world")}setGravity(e){this._nullCheck(),this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldSetGravity(this._inner.ptr,e.x,e.y,e.z)}stepSimulation(e,i,r){if(this._fromPointer)throw new Error("Cannot call stepSimulation on a world created from a pointer");this._nullCheck(),this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldStepSimulation(this._inner.ptr,e,i,r)}addRigidBody(e,i){if(e.runtime!==this._runtime)throw new Error("Cannot add rigid body from a different runtime");return this._nullCheck(),!!this._inner.addRigidBodyReference(e,i)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldAddRigidBody(this._inner.ptr,i,e.ptr),!0)}removeRigidBody(e,i){return this._nullCheck(),!!this._inner.removeRigidBodyReference(e)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldRemoveRigidBody(this._inner.ptr,i,e.ptr),!0)}addRigidBodyBundle(e,i){if(e.runtime!==this._runtime)throw new Error("Cannot add rigid body bundle from a different runtime");return this._nullCheck(),!!this._inner.addRigidBodyBundleReference(e,i)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldAddRigidBodyBundle(this._inner.ptr,i,e.ptr),!0)}removeRigidBodyBundle(e,i){return this._nullCheck(),!!this._inner.removeRigidBodyBundleReference(e)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldRemoveRigidBodyBundle(this._inner.ptr,i,e.ptr),!0)}addRigidBodyToGlobal(e){if(e.runtime!==this._runtime)throw new Error("Cannot add rigid body from a different runtime");if(e.isDynamic)throw new Error("Cannot add dynamic rigid body to global");return this._nullCheck(),!!this._inner.addRigidBodyGlobalReference(e)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldAddRigidBodyToGlobal(this._inner.ptr,e.ptr),!0)}removeRigidBodyFromGlobal(e){return this._nullCheck(),!!this._inner.removeRigidBodyGlobalReference(e)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldRemoveRigidBodyFromGlobal(this._inner.ptr,e.ptr),!0)}addRigidBodyBundleToGlobal(e){if(e.runtime!==this._runtime)throw new Error("Cannot add rigid body bundle from a different runtime");if(e.isContainsDynamic)throw new Error("Cannot add dynamic rigid body bundle to global");return this._nullCheck(),!!this._inner.addRigidBodyBundleGlobalReference(e)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldAddRigidBodyBundleToGlobal(this._inner.ptr,e.ptr),!0)}removeRigidBodyBundleFromGlobal(e){return this._nullCheck(),!!this._inner.removeRigidBodyBundleGlobalReference(e)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldRemoveRigidBodyBundleFromGlobal(this._inner.ptr,e.ptr),!0)}addRigidBodyShadow(e,i){if(e.runtime!==this._runtime)throw new Error("Cannot add rigid body from a different runtime");return this._nullCheck(),!!this._inner.addRigidBodyShadowReference(e,i)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldAddRigidBodyShadow(this._inner.ptr,i,e.ptr),e.addShadowReference(),!0)}removeRigidBodyShadow(e,i){return this._nullCheck(),!!this._inner.removeRigidBodyShadowReference(e,i)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldRemoveRigidBodyShadow(this._inner.ptr,i,e.ptr),e.removeShadowReference(),!0)}addRigidBodyBundleShadow(e,i){if(e.runtime!==this._runtime)throw new Error("Cannot add rigid body bundle from a different runtime");return this._nullCheck(),!!this._inner.addRigidBodyBundleShadowReference(e,i)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldAddRigidBodyBundleShadow(this._inner.ptr,i,e.ptr),e.addShadowReference(),!0)}removeRigidBodyBundleShadow(e,i){return this._nullCheck(),!!this._inner.removeRigidBodyBundleShadowReference(e,i)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldRemoveRigidBodyBundleShadow(this._inner.ptr,i,e.ptr),e.removeShadowReference(),!0)}addConstraint(e,i,r){if(e.runtime!==this._runtime)throw new Error("Cannot add constraint from a different runtime");return this._nullCheck(),!!this._inner.addConstraintReference(e)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldAddConstraint(this._inner.ptr,i,e.ptr,r),!0)}removeConstraint(e,i){return this._nullCheck(),!!this._inner.removeConstraintReference(e)&&(this._runtime.lock.wait(),this._runtime.wasmInstance.multiPhysicsWorldRemoveConstraint(this._inner.ptr,i,e.ptr),!0)}}}}]);