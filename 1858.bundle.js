"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[1858],{1858:(e,n,t)=>{t.r(n),t.d(n,{SceneBuilder:()=>T}),t(203),t(1503),t(8227);var o=t(7456),a=t(5581),r=t(1513),s=t(9711),i=t(6041),c=t(9923),l=t(9899),w=t(8144),f=t(554),d=t(6738),u=t(7168),h=t(3948),p=t(9009),m=t(7744),g=t(6405),y=t(1592),q=t(7648),b=t(5901),P=t(3477),S=t(9800);class T{async build(e,n){const t=new f.Z(n);t.clearColor=new i.ov(.95,.95,.95,1);const T=new o.Lq("arcRotateCamera",0,0,500,new c.Pq(0,0,0),t);T.minZ=1,T.maxZ=3e3,T.setPosition(new c.Pq(60,40,-50).scaleInPlace(10)),T.attachControl(void 0,!1),T.inertia=.8,T.speed=10;const B=new r.g("hemisphericLight",new c.Pq(0,1,0),t);B.intensity=.5,B.specular=new i.v9(0,0,0),B.groundColor=new i.v9(1,1,1);const L=new a.Z("directionalLight",new c.Pq(.5,-1,1),t);L.intensity=.5;L.shadowMaxZ=250,L.shadowMinZ=-250,L.autoCalcShadowZBounds=!1,L.autoUpdateExtends=!1,L.shadowOrthoScale=0,L.orthoTop=250,L.orthoBottom=-250,L.orthoLeft=-250,L.orthoRight=250;const C=new s.o(2048,L,!0);C.transparencyShadow=!0,C.usePercentageCloserFiltering=!0,C.forceBackFacesOnly=!1,C.bias=.004,C.filteringQuality=s.o.QUALITY_MEDIUM;const v=await(0,d.e)(new m.t,4),I=new h.h(v,{allowDynamicShadow:!0,preserveBackBuffer:!0});I.evaluationType=p.q.Immediate;const x=new c.uq;{const e=(0,w.x)("ground",{size:500},t);e.rotationQuaternion=c.PT.RotationAxis(new c.Pq(1,0,0),Math.PI/2),C.addShadowCaster(e),e.receiveShadows=!0;const n=new g.Ty(I,new c.Pq(0,0,-1),0),o=new b.t(v);o.shape=n,c.uq.FromQuaternionToRef(e.rotationQuaternion,x),o.setInitialTransform(x),o.motionType=1;const a=new y.U(I,o);I.addRigidBodyToGlobal(a)}const A=512,R=(0,l.an)("box",{size:2},t);C.addShadowCaster(R),R.receiveShadows=!0;const k=new Float32Array(32768);R.thinInstanceSetBuffer("matrix",k,16,!1);const F=new Float32Array(8192),M=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"];for(let e=0;e<4;++e){const n=i.ov.FromHexString(M[e%M.length]);for(let t=0;t<A;++t)F[e*A*4+4*t+0]=n.r,F[e*A*4+4*t+1]=n.g,F[e*A*4+4*t+2]=n.b,F[e*A*4+4*t+3]=n.a}R.thinInstanceSetBuffer("color",F,4,!1);const U=new g.SA(I,new c.Pq(1,1,1)),Z=[];for(let e=0;e<2;++e)for(let n=0;n<2;++n){const t=2*e+n,o=20*(n-1)+10,a=20*(e-1)+10,r=new P.x(v,A);for(let e=0;e<A;++e){r.setShape(e,U);const n=c.uq.TranslationToRef(o,1+2*e,a,x);r.setInitialTransform(e,n),r.setFriction(e,1),r.setLinearDamping(e,.3),r.setAngularDamping(e,.3)}const s=new q.Y(I,r);I.addRigidBodyBundle(s,t);for(let e=0;e<4;++e)e!==t&&I.addRigidBodyBundleShadow(s,e);for(let e=0;e<A;e+=2){const n=[e,e+1],o=new u.vC(I,s,n,c.uq.Translation(0,-1.2,0),c.uq.Translation(0,1.2,0),!0);o.setLinearLowerLimit(new c.Pq(0,0,0)),o.setLinearUpperLimit(new c.Pq(0,0,0)),o.setAngularLowerLimit(new c.Pq(Math.PI/4,0,0)),o.setAngularUpperLimit(new c.Pq(0,0,0));for(let e=0;e<6;++e)o.enableSpring(e,!0),o.setStiffness(e,100),o.setDamping(e,1);I.addConstraint(o,t,!1)}Z.push(s)}console.log("Rigid body count:",2048),I.onTickObservable.add((()=>{for(let e=0;e<Z.length;++e)Z[e].getTransformMatricesToArray(k,e*A*16);R.thinInstanceBufferUpdated("matrix")}));const D=new S.X((()=>{const e=performance.now();I.afterAnimations(1/60*1e3);const n=performance.now(),o=n-e;return t.render(),[o,performance.now()-n]}));return D.sampleCount=5e3,D.runBench(),I.register(t),t}}}}]);