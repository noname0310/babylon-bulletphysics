"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[1858],{11858:(e,n,t)=>{t.r(n),t.d(n,{SceneBuilder:()=>T}),t(90203),t(33832),t(2093);var o=t(7839),a=t(52046),r=t(71513),i=t(18595),s=t(26041),l=t(79923),c=t(96793),d=t(58144),w=t(87491),f=t(46738),h=t(67168),u=t(23948),g=t(29009),p=t(27744),m=t(26405),y=t(1592),b=t(67648),q=t(35901),P=t(3477),S=t(89800);class T{async build(e,n){const t=new w.Z(n);t.clearColor=new s.ov(.95,.95,.95,1);const T=new o.L("arcRotateCamera",0,0,500,new l.Pq(0,0,0),t);T.minZ=1,T.maxZ=3e3,T.setPosition(new l.Pq(60,40,-50).scaleInPlace(10)),T.attachControl(void 0,!1),T.inertia=.8,T.speed=10;const B=new r.g("hemisphericLight",new l.Pq(0,1,0),t);B.intensity=.5,B.specular=new s.v9(0,0,0),B.groundColor=new s.v9(1,1,1);const L=new a.Z("directionalLight",new l.Pq(.5,-1,1),t);L.intensity=.5;L.shadowMaxZ=250,L.shadowMinZ=-250,L.autoCalcShadowZBounds=!1,L.autoUpdateExtends=!1,L.shadowOrthoScale=0,L.orthoTop=250,L.orthoBottom=-250,L.orthoLeft=-250,L.orthoRight=250;const C=new i.o(2048,L,!0);C.transparencyShadow=!0,C.usePercentageCloserFiltering=!0,C.forceBackFacesOnly=!1,C.bias=.004,C.filteringQuality=i.o.QUALITY_MEDIUM;const v=await(0,f.e)(new p.t,4),I=new u.h(v,{allowDynamicShadow:!0,preserveBackBuffer:!0});I.evaluationType=g.q.Immediate;const x=new l.uq;{const e=(0,d.x)("ground",{size:500},t);e.rotationQuaternion=l.PT.RotationAxis(new l.Pq(1,0,0),Math.PI/2),C.addShadowCaster(e),e.receiveShadows=!0;const n=new m.Ty(I,new l.Pq(0,0,-1),0),o=new q.t(v);o.shape=n,l.uq.FromQuaternionToRef(e.rotationQuaternion,x),o.setInitialTransform(x),o.motionType=1;const a=new y.U(I,o);I.addRigidBodyToGlobal(a)}const A=512,R=(0,c.an)("box",{size:2},t);C.addShadowCaster(R),R.receiveShadows=!0;const k=new Float32Array(32768);R.thinInstanceSetBuffer("matrix",k,16,!1);const F=new Float32Array(8192),M=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"];for(let e=0;e<4;++e){const n=s.ov.FromHexString(M[e%M.length]);for(let t=0;t<A;++t)F[e*A*4+4*t+0]=n.r,F[e*A*4+4*t+1]=n.g,F[e*A*4+4*t+2]=n.b,F[e*A*4+4*t+3]=n.a}R.thinInstanceSetBuffer("color",F,4,!1);const U=new m.SA(I,new l.Pq(1,1,1)),Z=[];for(let e=0;e<2;++e)for(let n=0;n<2;++n){const t=2*e+n,o=20*(n-1)+10,a=20*(e-1)+10,r=new P.x(v,A);for(let e=0;e<A;++e){r.setShape(e,U);const n=l.uq.TranslationToRef(o,1+2*e,a,x);r.setInitialTransform(e,n),r.setFriction(e,1),r.setLinearDamping(e,.3),r.setAngularDamping(e,.3)}const i=new b.Y(I,r);I.addRigidBodyBundle(i,t);for(let e=0;e<4;++e)e!==t&&I.addRigidBodyBundleShadow(i,e);for(let e=0;e<A;e+=2){const n=[e,e+1],o=new h.vC(I,i,n,l.uq.Translation(0,-1.2,0),l.uq.Translation(0,1.2,0),!0);o.setLinearLowerLimit(new l.Pq(0,0,0)),o.setLinearUpperLimit(new l.Pq(0,0,0)),o.setAngularLowerLimit(new l.Pq(Math.PI/4,0,0)),o.setAngularUpperLimit(new l.Pq(0,0,0));for(let e=0;e<6;++e)o.enableSpring(e,!0),o.setStiffness(e,100),o.setDamping(e,1);I.addConstraint(o,t,!1)}Z.push(i)}console.log("Rigid body count:",2048),I.onTickObservable.add((()=>{for(let e=0;e<Z.length;++e)Z[e].getTransformMatricesToArray(k,e*A*16);R.thinInstanceBufferUpdated("matrix")}));const D=new S.X((()=>{I.afterAnimations(1/60*1e3),t.render()}));return D.sampleCount=5e3,D.runBench(),I.register(t),t}}}}]);