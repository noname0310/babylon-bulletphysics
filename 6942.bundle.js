"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[6942],{6942:(e,n,t)=>{t.r(n),t.d(n,{SceneBuilder:()=>T}),t(203),t(1503),t(8227);var o=t(7456),a=t(5581),r=t(1513),i=t(9711),s=t(6041),l=t(9923),c=t(9899),w=t(8144),d=t(554),f=t(6738),h=t(7168),u=t(3948),p=t(9009),g=t(7002),m=t(6405),y=t(1592),q=t(7648),P=t(5901),S=t(3477);class T{async build(e,n){const t=new d.Z(n);t.clearColor=new s.ov(.95,.95,.95,1);const T=new o.Lq("arcRotateCamera",0,0,500,new l.Pq(0,0,0),t);T.minZ=1,T.maxZ=3e3,T.setPosition(new l.Pq(60,40,-50).scaleInPlace(10)),T.attachControl(void 0,!1),T.inertia=.8,T.speed=10;const b=new r.g("hemisphericLight",new l.Pq(0,1,0),t);b.intensity=.5,b.specular=new s.v9(0,0,0),b.groundColor=new s.v9(1,1,1);const B=new a.Z("directionalLight",new l.Pq(.5,-1,1),t);B.intensity=.5;B.shadowMaxZ=250,B.shadowMinZ=-250,B.autoCalcShadowZBounds=!1,B.autoUpdateExtends=!1,B.shadowOrthoScale=0,B.orthoTop=250,B.orthoBottom=-250,B.orthoLeft=-250,B.orthoRight=250;const L=new i.o(2048,B,!0);L.transparencyShadow=!0,L.usePercentageCloserFiltering=!0,L.forceBackFacesOnly=!1,L.bias=.004,L.filteringQuality=i.o.QUALITY_MEDIUM;const v=await(0,f.e)(new g.t,32),C=new u.h(v,{allowDynamicShadow:!0,preserveBackBuffer:!0});C.register(t),C.evaluationType=p.q.Immediate;const I=new l.uq;{const e=(0,w.x)("ground",{size:500},t);e.rotationQuaternion=l.PT.RotationAxis(new l.Pq(1,0,0),Math.PI/2),L.addShadowCaster(e),e.receiveShadows=!0;const n=new m.Ty(C,new l.Pq(0,0,-1),0),o=new P.t(v);o.shape=n,l.uq.FromQuaternionToRef(e.rotationQuaternion,I),o.setInitialTransform(I),o.motionType=1;const a=new y.U(C,o);C.addRigidBodyToGlobal(a)}const x=512,A=(0,c.an)("box",{size:2},t);L.addShadowCaster(A),A.receiveShadows=!0;const R=new Float32Array(262144);A.thinInstanceSetBuffer("matrix",R,16,!1);const k=new Float32Array(65536),F=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"];for(let e=0;e<32;++e){const n=s.ov.FromHexString(F[e%F.length]);for(let t=0;t<x;++t)k[e*x*4+4*t+0]=n.r,k[e*x*4+4*t+1]=n.g,k[e*x*4+4*t+2]=n.b,k[e*x*4+4*t+3]=n.a}A.thinInstanceSetBuffer("color",k,4,!1);const M=new m.SA(C,new l.Pq(1,1,1)),U=[];for(let e=0;e<4;++e)for(let n=0;n<8;++n){const t=8*e+n,o=20*(n-4)+10,a=20*(e-2)+10,r=new S.x(v,x);for(let e=0;e<x;++e){r.setShape(e,M);const n=l.uq.TranslationToRef(o,1+2*e,a,I);r.setInitialTransform(e,n),r.setFriction(e,1),r.setLinearDamping(e,.3),r.setAngularDamping(e,.3)}const i=new q.Y(C,r);C.addRigidBodyBundle(i,t);for(let e=0;e<32;++e)e!==t&&C.addRigidBodyBundleShadow(i,e);for(let e=0;e<x;e+=2){const n=[e,e+1],o=new h.vC(C,i,n,l.uq.Translation(0,-1.2,0),l.uq.Translation(0,1.2,0),!0);o.setLinearLowerLimit(new l.Pq(0,0,0)),o.setLinearUpperLimit(new l.Pq(0,0,0)),o.setAngularLowerLimit(new l.Pq(Math.PI/4,0,0)),o.setAngularUpperLimit(new l.Pq(0,0,0));for(let e=0;e<6;++e)o.enableSpring(e,!0),o.setStiffness(e,100),o.setDamping(e,1);C.addConstraint(o,t,!1)}U.push(i)}return C.onTickObservable.add((()=>{for(let e=0;e<U.length;++e)U[e].getTransformMatricesToArray(R,e*x*16);A.thinInstanceBufferUpdated("matrix")})),t}}}}]);