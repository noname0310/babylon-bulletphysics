"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[9297],{4871:(e,t,n)=>{e.exports=n.p+"8235fd80d366b40d6cfa.wasm"},7648:(e,t,n)=>{n.d(t,{Y:()=>s});class i{_wasmInstance;_ptr;_shapeReferences;_referenceCount;_shadowCount;constructor(e,t,n){this._wasmInstance=e,this._ptr=t,this._shapeReferences=n;for(const e of n)e.addReference();this._referenceCount=0,this._shadowCount=0}dispose(){if(this._referenceCount>0)throw new Error("Cannot dispose rigid body bundle while it still has references");if(0!==this._ptr){this._wasmInstance.deref()?.destroyRigidBodyBundle(this._ptr),this._ptr=0;for(const e of this._shapeReferences)e.removeReference();this._shapeReferences.clear()}}get ptr(){return this._ptr}addReference(){this._referenceCount+=1}removeReference(){this._referenceCount-=1}get hasReferences(){return 0<this._referenceCount}addShadow(){this._shadowCount+=1}removeShadow(){this._shadowCount-=1}get hasShadows(){return 0<this._shadowCount}}function r(e){e.dispose()}const o=new WeakMap;class s{runtime;_motionStatesPtr;_bufferedMotionStatesPtr;_worldTransformPtrArray;_temporalKinematicStatesPtr;_inner;_count;_worldReference;impl;isContainsDynamic;constructor(e,t){if(0===t.ptr)throw new Error("Cannot create rigid body bundle with null pointer");const n=t.count,s=new Set;for(let i=0;i<n;++i){const n=t.getShape(i);if(null===n)throw new Error("Cannot create rigid body bundle with null shape");if(n.runtime!==e)throw new Error("Cannot create rigid body bundle with shapes from different runtimes");s.add(n)}this.runtime=e;const d=e.wasmInstance,a=d.createRigidBodyBundle(t.ptr,n),u=d.rigidBodyBundleGetMotionStatesPtr(a);this._motionStatesPtr=d.createTypedArray(Float32Array,u,20*n);const l=d.rigidBodyBundleGetBufferedMotionStatesPtr(a);this._bufferedMotionStatesPtr=d.createTypedArray(Float32Array,l,20*n);const c=[];let y=!1;for(let e=0;e<n;++e)if(0===t.getMotionType(e)){y=!0;const t=d.rigidBodyBundleGetWorldTransformPtr(a,e);c.push(d.createTypedArray(Float32Array,t,16))}else c.push(null);this._worldTransformPtrArray=c;const h=d.rigidBodyBundleGetTemporalKinematicStatesPtr(a);this._temporalKinematicStatesPtr=d.createTypedArray(Uint8Array,h,n),this._inner=new i(new WeakRef(e.wasmInstance),a,s),this._count=n,this._worldReference=null;let f=o.get(d);void 0===f&&(f=new FinalizationRegistry(r),o.set(d,f)),f.register(this,this._inner,this),this.impl=e.createRigidBodyBundleImpl(this),this.isContainsDynamic=y}dispose(){if(0===this._inner.ptr)return;this._inner.dispose();const e=o.get(this.runtime.wasmInstance);e?.unregister(this)}get ptr(){return this._inner.ptr}get count(){return this._count}addReference(){this._inner.addReference()}removeReference(){this._inner.removeReference()}addShadowReference(){this._inner.addShadow()}removeShadowReference(){this._inner.removeShadow()}get hasShadows(){return this._inner.hasShadows}setWorldReference(e){if(null!==this._worldReference&&null!==e)throw new Error("Cannot add rigid body bundle to multiple worlds");this._worldReference!==e&&(this._worldReference=e,null!==e?this._inner.addReference():this._inner.removeReference())}getWorldReference(){return this._worldReference}updateBufferedMotionStates(e){if(this._nullCheck(),e){const e=this.runtime.wasmInstance.rigidBodyBundleGetMotionStatesPtr(this._inner.ptr);this._bufferedMotionStatesPtr=this.runtime.wasmInstance.createTypedArray(Float32Array,e,20*this._count)}else{const e=this.runtime.wasmInstance.rigidBodyBundleGetBufferedMotionStatesPtr(this._inner.ptr);this._bufferedMotionStatesPtr=this.runtime.wasmInstance.createTypedArray(Float32Array,e,20*this._count)}}_nullCheck(){if(0===this._inner.ptr)throw new Error("Cannot access disposed rigid body bundle")}getTransformMatrixToRef(e,t){if(this._nullCheck(),e<0||this._count<=e)throw new RangeError("Index out of range");this._inner.hasReferences&&this.impl.shouldSync&&this.runtime.lock.wait();const n=this._bufferedMotionStatesPtr.array,i=20*e;return t.set(n[i+4+0],n[i+8+0],n[i+12+0],0,n[i+4+1],n[i+8+1],n[i+12+1],0,n[i+4+2],n[i+8+2],n[i+12+2],0,n[i+16+0],n[i+16+1],n[i+16+2],1)}getTransformMatrixToArray(e,t,n=0){if(this._nullCheck(),e<0||this._count<=e)throw new RangeError("Index out of range");this._inner.hasReferences&&this.impl.shouldSync&&this.runtime.lock.wait();const i=this._bufferedMotionStatesPtr.array,r=20*e;t[n+0]=i[r+4+0],t[n+1]=i[r+8+0],t[n+2]=i[r+12+0],t[n+3]=0,t[n+4]=i[r+4+1],t[n+5]=i[r+8+1],t[n+6]=i[r+12+1],t[n+7]=0,t[n+8]=i[r+4+2],t[n+9]=i[r+8+2],t[n+10]=i[r+12+2],t[n+11]=0,t[n+12]=i[r+16+0],t[n+13]=i[r+16+1],t[n+14]=i[r+16+2],t[n+15]=1}getTransformMatricesToArray(e,t=0){this._nullCheck(),this._inner.hasReferences&&this.impl.shouldSync&&this.runtime.lock.wait();const n=this._bufferedMotionStatesPtr.array,i=this._count;let r=0,o=t;for(let t=0;t<i;++t)e[o+0]=n[r+4+0],e[o+1]=n[r+8+0],e[o+2]=n[r+12+0],e[o+3]=0,e[o+4]=n[r+4+1],e[o+5]=n[r+8+1],e[o+6]=n[r+12+1],e[o+7]=0,e[o+8]=n[r+4+2],e[o+9]=n[r+8+2],e[o+10]=n[r+12+2],e[o+11]=0,e[o+12]=n[r+16+0],e[o+13]=n[r+16+1],e[o+14]=n[r+16+2],e[o+15]=1,r+=20,o+=16}setTransformMatrix(e,t){this.setTransformMatrixFromArray(e,t.m,0)}setTransformMatrixFromArray(e,t,n=0){if(this._nullCheck(),e<0||this._count<=e)throw new RangeError("Index out of range");this._inner.hasReferences&&this.impl.shouldSync&&this.runtime.lock.wait(),this.impl.setTransformMatrixFromArray(this._motionStatesPtr,this._temporalKinematicStatesPtr,e,t,n)}setTransformMatricesFromArray(e,t=0){if(this._nullCheck(),e.length<16*this._count)throw new RangeError("Array is too short");this._inner.hasReferences&&this.impl.shouldSync&&this.runtime.lock.wait(),this.impl.setTransformMatricesFromArray(this._motionStatesPtr,this._temporalKinematicStatesPtr,e,t)}setDynamicTransformMatrix(e){this.setTransformMatricesFromArray(e.m,0)}setDynamicTransformMatrixFromArray(e,t,n=0){if(null===this._worldTransformPtrArray[e])throw new Error("Cannot set dynamic transform of non-dynamic body");if(this._nullCheck(),e<0||this._count<=e)throw new RangeError("Index out of range");this._inner.hasReferences&&this.impl.shouldSync&&this.runtime.lock.wait(),this.impl.setDynamicTransformMatrixFromArray(this._worldTransformPtrArray,e,t,n)}setDamping(e,t,n){if(this._nullCheck(),e<0||this._count<=e)throw new RangeError("Index out of range");this._inner.hasReferences&&this.impl.shouldSync&&this.runtime.lock.wait(),this.impl.setDamping(this.runtime.wasmInstance,this._inner.ptr,e,t,n)}getLinearDamping(e){if(this._nullCheck(),e<0||this._count<=e)throw new RangeError("Index out of range");return this._inner.hasReferences&&this.impl.shouldSync&&this.runtime.lock.wait(),this.impl.getLinearDamping(this.runtime.wasmInstance,this._inner.ptr,e)}getAngularDamping(e){if(this._nullCheck(),e<0||this._count<=e)throw new RangeError("Index out of range");return this._inner.hasReferences&&this.impl.shouldSync&&this.runtime.lock.wait(),this.impl.getAngularDamping(this.runtime.wasmInstance,this._inner.ptr,e)}setMassProps(e,t,n){if(this._nullCheck(),e<0||this._count<=e)throw new RangeError("Index out of range");this._inner.hasReferences&&this.impl.shouldSync&&this.runtime.lock.wait(),this.impl.setMassProps(this.runtime.wasmInstance,this._inner.ptr,e,t,n)}getMass(e){if(this._nullCheck(),e<0||this._count<=e)throw new RangeError("Index out of range");return this._inner.hasReferences&&this.impl.shouldSync&&this.runtime.lock.wait(),this.impl.getMass(this.runtime.wasmInstance,this._inner.ptr,e)}getLocalInertia(e){if(this._nullCheck(),e<0||this._count<=e)throw new RangeError("Index out of range");return this._inner.hasReferences&&this.impl.shouldSync&&this.runtime.lock.wait(),this.impl.getLocalInertia(this.runtime.wasmInstance,this._inner.ptr,e)}get needToCommit(){return this.impl.needToCommit??!1}commitToWasm(){if(void 0===this.impl.commitToWasm)throw new Error("commit only avalible on buffered evaluation mode");this._nullCheck(),this.runtime.lock.wait(),this.impl.commitToWasm(this.runtime.wasmInstance,this._inner.ptr,this._motionStatesPtr,this._temporalKinematicStatesPtr,this._worldTransformPtrArray)}}},9297:(e,t,n)=>{n.r(t),n.d(t,{SceneBuilder:()=>yn});var i={};n.r(i),n.d(i,{allocateBuffer:()=>W,constraintEnableSpring:()=>Pe,constraintSetAngularLowerLimit:()=>_e,constraintSetAngularUpperLimit:()=>Se,constraintSetDamping:()=>Ae,constraintSetLinearLowerLimit:()=>Be,constraintSetLinearUpperLimit:()=>we,constraintSetStiffness:()=>Re,createBoxShape:()=>be,createCapsuleShape:()=>Ge,createGeneric6DofConstraint:()=>he,createGeneric6DofConstraintFromBundle:()=>fe,createGeneric6DofSpringConstraint:()=>me,createGeneric6DofSpringConstraintFromBundle:()=>ge,createMultiPhysicsRuntime:()=>at,createMultiPhysicsWorld:()=>Ue,createPhysicsRuntime:()=>ct,createPhysicsWorld:()=>Ie,createRigidBody:()=>M,createRigidBodyBundle:()=>ft,createSphereShape:()=>Te,createStaticPlaneShape:()=>Ce,deallocateBuffer:()=>I,default:()=>sn,destroyConstraint:()=>pe,destroyMultiPhysicsRuntime:()=>ut,destroyMultiPhysicsWorld:()=>Ke,destroyPhysicsRuntime:()=>yt,destroyPhysicsWorld:()=>Me,destroyRigidBody:()=>L,destroyRigidBodyBundle:()=>mt,destroyShape:()=>We,init:()=>G,initSync:()=>rn,multiPhysicsRuntimeGetLockStatePtr:()=>lt,multiPhysicsWorldAddConstraint:()=>it,multiPhysicsWorldAddRigidBody:()=>Ze,multiPhysicsWorldAddRigidBodyBundle:()=>ze,multiPhysicsWorldAddRigidBodyBundleShadow:()=>tt,multiPhysicsWorldAddRigidBodyBundleToGlobal:()=>He,multiPhysicsWorldAddRigidBodyShadow:()=>Xe,multiPhysicsWorldAddRigidBodyToGlobal:()=>$e,multiPhysicsWorldMakeBodyKinematic:()=>ot,multiPhysicsWorldRemoveConstraint:()=>rt,multiPhysicsWorldRemoveRigidBody:()=>Qe,multiPhysicsWorldRemoveRigidBodyBundle:()=>Ye,multiPhysicsWorldRemoveRigidBodyBundleFromGlobal:()=>Ne,multiPhysicsWorldRemoveRigidBodyBundleShadow:()=>nt,multiPhysicsWorldRemoveRigidBodyFromGlobal:()=>Je,multiPhysicsWorldRemoveRigidBodyShadow:()=>et,multiPhysicsWorldRestoreBodyDynamic:()=>st,multiPhysicsWorldSetGravity:()=>Oe,multiPhysicsWorldStepSimulation:()=>je,multiPhysicsWorldUseMotionStateBuffer:()=>dt,physicsRuntimeGetLockStatePtr:()=>ht,physicsWorldAddConstraint:()=>Ve,physicsWorldAddRigidBody:()=>ke,physicsWorldAddRigidBodyBundle:()=>Fe,physicsWorldRemoveConstraint:()=>Ee,physicsWorldRemoveRigidBody:()=>De,physicsWorldRemoveRigidBodyBundle:()=>xe,physicsWorldSetGravity:()=>Le,physicsWorldStepSimulation:()=>ve,physicsWorldUseMotionStateBuffer:()=>qe,rigidBodyApplyCentralForce:()=>O,rigidBodyApplyCentralImpulse:()=>Q,rigidBodyApplyCentralPushImpulse:()=>ee,rigidBodyApplyForce:()=>Z,rigidBodyApplyImpulse:()=>Y,rigidBodyApplyPushImpulse:()=>$,rigidBodyApplyTorque:()=>j,rigidBodyApplyTorqueImpulse:()=>z,rigidBodyApplyTorqueTurnImpulse:()=>te,rigidBodyBundleApplyCentralForce:()=>Tt,rigidBodyBundleApplyCentralImpulse:()=>Wt,rigidBodyBundleApplyCentralPushImpulse:()=>xt,rigidBodyBundleApplyForce:()=>Ct,rigidBodyBundleApplyImpulse:()=>Mt,rigidBodyBundleApplyPushImpulse:()=>Lt,rigidBodyBundleApplyTorque:()=>Gt,rigidBodyBundleApplyTorqueImpulse:()=>It,rigidBodyBundleApplyTorqueTurnImpulse:()=>Vt,rigidBodyBundleClearForces:()=>Et,rigidBodyBundleGetAngularDamping:()=>_t,rigidBodyBundleGetAngularVelocity:()=>Ut,rigidBodyBundleGetBufferedMotionStatesPtr:()=>pt,rigidBodyBundleGetLinearDamping:()=>wt,rigidBodyBundleGetLinearVelocity:()=>qt,rigidBodyBundleGetLocalInertia:()=>Rt,rigidBodyBundleGetMass:()=>Pt,rigidBodyBundleGetMotionStatesPtr:()=>gt,rigidBodyBundleGetPushVelocity:()=>vt,rigidBodyBundleGetPushVelocityInLocalPoint:()=>Zt,rigidBodyBundleGetTemporalKinematicStatesPtr:()=>Yt,rigidBodyBundleGetTotalForce:()=>At,rigidBodyBundleGetTotalTorque:()=>bt,rigidBodyBundleGetTurnVelocity:()=>kt,rigidBodyBundleGetVelocityInLocalPoint:()=>jt,rigidBodyBundleGetWorldTransformPtr:()=>zt,rigidBodyBundleSetAngularVelocity:()=>Ot,rigidBodyBundleSetDamping:()=>Bt,rigidBodyBundleSetLinearVelocity:()=>Kt,rigidBodyBundleSetMassProps:()=>St,rigidBodyBundleSetPushVelocity:()=>Dt,rigidBodyBundleSetTurnVelocity:()=>Ft,rigidBodyBundleTranslate:()=>Qt,rigidBodyClearForces:()=>ne,rigidBodyGetAngularDamping:()=>x,rigidBodyGetAngularVelocity:()=>re,rigidBodyGetBufferedMotionStatePtr:()=>k,rigidBodyGetLinearDamping:()=>F,rigidBodyGetLinearVelocity:()=>ie,rigidBodyGetLocalInertia:()=>q,rigidBodyGetMass:()=>E,rigidBodyGetMotionStatePtr:()=>v,rigidBodyGetPushVelocity:()=>J,rigidBodyGetPushVelocityInLocalPoint:()=>ae,rigidBodyGetTemporalKinematicStatePtr:()=>ce,rigidBodyGetTotalForce:()=>U,rigidBodyGetTotalTorque:()=>K,rigidBodyGetTurnVelocity:()=>H,rigidBodyGetVelocityInLocalPoint:()=>de,rigidBodyGetWorldTransformPtr:()=>le,rigidBodySetAngularVelocity:()=>se,rigidBodySetDamping:()=>D,rigidBodySetLinearVelocity:()=>oe,rigidBodySetMassProps:()=>V,rigidBodySetPushVelocity:()=>N,rigidBodySetTurnVelocity:()=>X,rigidBodyTranslate:()=>ue}),n(203),n(1503),n(8227);var r=n(7456),o=n(5581),s=n(1513),d=n(9711),a=n(6041),u=n(9923),l=n(9899),c=n(8144),y=n(554),h=n(6738),f=n(7168),m=n(3948),g=n(9009),p=n(7002);let B;const w="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&w.decode();let _=null;function S(){return null!==_&&0!==_.byteLength||(_=new Uint8Array(B.memory.buffer)),_}function P(e,t){return e>>>=0,w.decode(S().subarray(e,e+t))}const R=new Array(128).fill(void 0);R.push(void 0,null,!0,!1);let A=R.length;function b(e){A===R.length&&R.push(R.length+1);const t=A;if(A=R[t],"number"!=typeof A)throw new Error("corrupt heap");return R[t]=e,t}function T(e){return R[e]}function G(){B.init()}function C(e){if("number"!=typeof e)throw new Error("expected a number argument, found "+typeof e)}function W(e){return C(e),B.allocateBuffer(e)>>>0}function I(e,t){C(e),C(t),B.deallocateBuffer(e,t)}function M(e){return C(e),B.createRigidBody(e)>>>0}function L(e){C(e),B.destroyRigidBody(e)}function v(e){return C(e),B.rigidBodyGetMotionStatePtr(e)>>>0}function k(e){return C(e),B.rigidBodyGetBufferedMotionStatePtr(e)>>>0}function D(e,t,n){C(e),B.rigidBodySetDamping(e,t,n)}function F(e){return C(e),B.rigidBodyGetLinearDamping(e)}function x(e){return C(e),B.rigidBodyGetAngularDamping(e)}function V(e,t,n,i,r){C(e),B.rigidBodySetMassProps(e,t,n,i,r)}function E(e){return C(e),B.rigidBodyGetMass(e)}function q(e,t){C(e),C(t),B.rigidBodyGetLocalInertia(e,t)}function U(e,t){C(e),C(t),B.rigidBodyGetTotalForce(e,t)}function K(e,t){C(e),C(t),B.rigidBodyGetTotalTorque(e,t)}function O(e,t,n,i){C(e),B.rigidBodyApplyCentralForce(e,t,n,i)}function j(e,t,n,i){C(e),B.rigidBodyApplyTorque(e,t,n,i)}function Z(e,t,n){C(e),C(t),C(n),B.rigidBodyApplyForce(e,t,n)}function Q(e,t,n,i){C(e),B.rigidBodyApplyCentralImpulse(e,t,n,i)}function z(e,t,n,i){C(e),B.rigidBodyApplyTorqueImpulse(e,t,n,i)}function Y(e,t,n){C(e),C(t),C(n),B.rigidBodyApplyImpulse(e,t,n)}function $(e,t,n){C(e),C(t),C(n),B.rigidBodyApplyPushImpulse(e,t,n)}function J(e,t){C(e),C(t),B.rigidBodyGetPushVelocity(e,t)}function H(e,t){C(e),C(t),B.rigidBodyGetTurnVelocity(e,t)}function N(e,t,n,i){C(e),B.rigidBodySetPushVelocity(e,t,n,i)}function X(e,t,n,i){C(e),B.rigidBodySetTurnVelocity(e,t,n,i)}function ee(e,t,n,i){C(e),B.rigidBodyApplyCentralPushImpulse(e,t,n,i)}function te(e,t,n,i){C(e),B.rigidBodyApplyTorqueTurnImpulse(e,t,n,i)}function ne(e){C(e),B.rigidBodyClearForces(e)}function ie(e,t){C(e),C(t),B.rigidBodyGetLinearVelocity(e,t)}function re(e,t){C(e),C(t),B.rigidBodyGetAngularVelocity(e,t)}function oe(e,t,n,i){C(e),B.rigidBodySetLinearVelocity(e,t,n,i)}function se(e,t,n,i){C(e),B.rigidBodySetAngularVelocity(e,t,n,i)}function de(e,t,n){C(e),C(t),C(n),B.rigidBodyGetVelocityInLocalPoint(e,t,n)}function ae(e,t,n){C(e),C(t),C(n),B.rigidBodyGetPushVelocityInLocalPoint(e,t,n)}function ue(e,t,n,i){C(e),B.rigidBodyTranslate(e,t,n,i)}function le(e){return C(e),B.rigidBodyGetWorldTransformPtr(e)>>>0}function ce(e){return C(e),B.rigidBodyGetTemporalKinematicStatePtr(e)>>>0}function ye(e){if("boolean"!=typeof e)throw new Error("expected a boolean argument, found "+typeof e)}function he(e,t,n,i,r){return C(e),C(t),C(n),C(i),ye(r),B.createGeneric6DofConstraint(e,t,n,i,r)>>>0}function fe(e,t,n,i,r,o){return C(e),C(t),C(n),C(i),C(r),ye(o),B.createGeneric6DofConstraintFromBundle(e,t,n,i,r,o)>>>0}function me(e,t,n,i,r){return C(e),C(t),C(n),C(i),ye(r),B.createGeneric6DofSpringConstraint(e,t,n,i,r)>>>0}function ge(e,t,n,i,r,o){return C(e),C(t),C(n),C(i),C(r),ye(o),B.createGeneric6DofSpringConstraintFromBundle(e,t,n,i,r,o)>>>0}function pe(e){C(e),B.destroyConstraint(e)}function Be(e,t,n,i){C(e),B.constraintSetLinearLowerLimit(e,t,n,i)}function we(e,t,n,i){C(e),B.constraintSetLinearUpperLimit(e,t,n,i)}function _e(e,t,n,i){C(e),B.constraintSetAngularLowerLimit(e,t,n,i)}function Se(e,t,n,i){C(e),B.constraintSetAngularUpperLimit(e,t,n,i)}function Pe(e,t,n){C(e),C(t),ye(n),B.constraintEnableSpring(e,t,n)}function Re(e,t,n){C(e),C(t),B.constraintSetStiffness(e,t,n)}function Ae(e,t,n){C(e),C(t),B.constraintSetDamping(e,t,n)}function be(e,t,n){return B.createBoxShape(e,t,n)>>>0}function Te(e){return B.createSphereShape(e)>>>0}function Ge(e,t){return B.createCapsuleShape(e,t)>>>0}function Ce(e,t,n,i){return B.createStaticPlaneShape(e,t,n,i)>>>0}function We(e){C(e),B.destroyShape(e)}function Ie(){return B.createPhysicsWorld()>>>0}function Me(e){C(e),B.destroyPhysicsWorld(e)}function Le(e,t,n,i){C(e),B.physicsWorldSetGravity(e,t,n,i)}function ve(e,t,n,i){C(e),C(n),B.physicsWorldStepSimulation(e,t,n,i)}function ke(e,t){C(e),C(t),B.physicsWorldAddRigidBody(e,t)}function De(e,t){C(e),C(t),B.physicsWorldRemoveRigidBody(e,t)}function Fe(e,t){C(e),C(t),B.physicsWorldAddRigidBodyBundle(e,t)}function xe(e,t){C(e),C(t),B.physicsWorldRemoveRigidBodyBundle(e,t)}function Ve(e,t,n){C(e),C(t),ye(n),B.physicsWorldAddConstraint(e,t,n)}function Ee(e,t){C(e),C(t),B.physicsWorldRemoveConstraint(e,t)}function qe(e,t){C(e),ye(t),B.physicsWorldUseMotionStateBuffer(e,t)}function Ue(e){return ye(e),B.createMultiPhysicsWorld(e)>>>0}function Ke(e){C(e),B.destroyMultiPhysicsWorld(e)}function Oe(e,t,n,i){C(e),B.multiPhysicsWorldSetGravity(e,t,n,i)}function je(e,t,n,i){C(e),C(n),B.multiPhysicsWorldStepSimulation(e,t,n,i)}function Ze(e,t,n){C(e),C(t),C(n),B.multiPhysicsWorldAddRigidBody(e,t,n)}function Qe(e,t,n){C(e),C(t),C(n),B.multiPhysicsWorldRemoveRigidBody(e,t,n)}function ze(e,t,n){C(e),C(t),C(n),B.multiPhysicsWorldAddRigidBodyBundle(e,t,n)}function Ye(e,t,n){C(e),C(t),C(n),B.multiPhysicsWorldRemoveRigidBodyBundle(e,t,n)}function $e(e,t){C(e),C(t),B.multiPhysicsWorldAddRigidBodyToGlobal(e,t)}function Je(e,t){C(e),C(t),B.multiPhysicsWorldRemoveRigidBodyFromGlobal(e,t)}function He(e,t){C(e),C(t),B.multiPhysicsWorldAddRigidBodyBundleToGlobal(e,t)}function Ne(e,t){C(e),C(t),B.multiPhysicsWorldRemoveRigidBodyBundleFromGlobal(e,t)}function Xe(e,t,n){C(e),C(t),C(n),B.multiPhysicsWorldAddRigidBodyShadow(e,t,n)}function et(e,t,n){C(e),C(t),C(n),B.multiPhysicsWorldRemoveRigidBodyShadow(e,t,n)}function tt(e,t,n){C(e),C(t),C(n),B.multiPhysicsWorldAddRigidBodyBundleShadow(e,t,n)}function nt(e,t,n){C(e),C(t),C(n),B.multiPhysicsWorldRemoveRigidBodyBundleShadow(e,t,n)}function it(e,t,n,i){C(e),C(t),C(n),ye(i),B.multiPhysicsWorldAddConstraint(e,t,n,i)}function rt(e,t,n){C(e),C(t),C(n),B.multiPhysicsWorldRemoveConstraint(e,t,n)}function ot(e,t){C(e),C(t),B.multiPhysicsWorldMakeBodyKinematic(e,t)}function st(e,t){C(e),C(t),B.multiPhysicsWorldRestoreBodyDynamic(e,t)}function dt(e,t){C(e),ye(t),B.multiPhysicsWorldUseMotionStateBuffer(e,t)}function at(e){return C(e),B.createMultiPhysicsRuntime(e)>>>0}function ut(e){C(e),B.destroyMultiPhysicsRuntime(e)}function lt(e){return C(e),B.multiPhysicsRuntimeGetLockStatePtr(e)>>>0}function ct(e){return C(e),B.createPhysicsRuntime(e)>>>0}function yt(e){C(e),B.destroyPhysicsRuntime(e)}function ht(e){return C(e),B.physicsRuntimeGetLockStatePtr(e)>>>0}function ft(e,t){return C(e),C(t),B.createRigidBodyBundle(e,t)>>>0}function mt(e){C(e),B.destroyRigidBodyBundle(e)}function gt(e){return C(e),B.rigidBodyBundleGetMotionStatesPtr(e)>>>0}function pt(e){return C(e),B.rigidBodyBundleGetBufferedMotionStatesPtr(e)>>>0}function Bt(e,t,n,i){C(e),C(t),B.rigidBodyBundleSetDamping(e,t,n,i)}function wt(e,t){return C(e),C(t),B.rigidBodyBundleGetLinearDamping(e,t)}function _t(e,t){return C(e),C(t),B.rigidBodyBundleGetAngularDamping(e,t)}function St(e,t,n,i,r,o){C(e),C(t),B.rigidBodyBundleSetMassProps(e,t,n,i,r,o)}function Pt(e,t){return C(e),C(t),B.rigidBodyBundleGetMass(e,t)}function Rt(e,t,n){C(e),C(t),C(n),B.rigidBodyBundleGetLocalInertia(e,t,n)}function At(e,t,n){C(e),C(t),C(n),B.rigidBodyBundleGetTotalForce(e,t,n)}function bt(e,t,n){C(e),C(t),C(n),B.rigidBodyBundleGetTotalTorque(e,t,n)}function Tt(e,t,n,i,r){C(e),C(t),B.rigidBodyBundleApplyCentralForce(e,t,n,i,r)}function Gt(e,t,n,i,r){C(e),C(t),B.rigidBodyBundleApplyTorque(e,t,n,i,r)}function Ct(e,t,n,i){C(e),C(t),C(n),C(i),B.rigidBodyBundleApplyForce(e,t,n,i)}function Wt(e,t,n,i,r){C(e),C(t),B.rigidBodyBundleApplyCentralImpulse(e,t,n,i,r)}function It(e,t,n,i,r){C(e),C(t),B.rigidBodyBundleApplyTorqueImpulse(e,t,n,i,r)}function Mt(e,t,n,i){C(e),C(t),C(n),C(i),B.rigidBodyBundleApplyImpulse(e,t,n,i)}function Lt(e,t,n,i){C(e),C(t),C(n),C(i),B.rigidBodyBundleApplyPushImpulse(e,t,n,i)}function vt(e,t,n){C(e),C(t),C(n),B.rigidBodyBundleGetPushVelocity(e,t,n)}function kt(e,t,n){C(e),C(t),C(n),B.rigidBodyBundleGetTurnVelocity(e,t,n)}function Dt(e,t,n,i,r){C(e),C(t),B.rigidBodyBundleSetPushVelocity(e,t,n,i,r)}function Ft(e,t,n,i,r){C(e),C(t),B.rigidBodyBundleSetTurnVelocity(e,t,n,i,r)}function xt(e,t,n,i,r){C(e),C(t),B.rigidBodyBundleApplyCentralPushImpulse(e,t,n,i,r)}function Vt(e,t,n,i,r){C(e),C(t),B.rigidBodyBundleApplyTorqueTurnImpulse(e,t,n,i,r)}function Et(e,t){C(e),C(t),B.rigidBodyBundleClearForces(e,t)}function qt(e,t,n){C(e),C(t),C(n),B.rigidBodyBundleGetLinearVelocity(e,t,n)}function Ut(e,t,n){C(e),C(t),C(n),B.rigidBodyBundleGetAngularVelocity(e,t,n)}function Kt(e,t,n,i,r){C(e),C(t),B.rigidBodyBundleSetLinearVelocity(e,t,n,i,r)}function Ot(e,t,n,i,r){C(e),C(t),B.rigidBodyBundleSetAngularVelocity(e,t,n,i,r)}function jt(e,t,n,i){C(e),C(t),C(n),C(i),B.rigidBodyBundleGetVelocityInLocalPoint(e,t,n,i)}function Zt(e,t,n,i){C(e),C(t),C(n),C(i),B.rigidBodyBundleGetPushVelocityInLocalPoint(e,t,n,i)}function Qt(e,t,n,i,r){C(e),C(t),B.rigidBodyBundleTranslate(e,t,n,i,r)}function zt(e,t){return C(e),C(t),B.rigidBodyBundleGetWorldTransformPtr(e,t)>>>0}function Yt(e){return C(e),B.rigidBodyBundleGetTemporalKinematicStatesPtr(e)>>>0}function $t(e,t){try{return e.apply(this,t)}catch(e){let t=function(){try{return e instanceof Error?`${e.message}\n\nStack:\n${e.stack}`:e.toString()}catch(e){return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",t),e}}let Jt=0;const Ht="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Nt="function"==typeof Ht.encodeInto?function(e,t){return Ht.encodeInto(e,t)}:function(e,t){const n=Ht.encode(e);return t.set(n),{read:e.length,written:n.length}};let Xt=null;function en(){return(null===Xt||!0===Xt.buffer.detached||void 0===Xt.buffer.detached&&Xt.buffer!==B.memory.buffer)&&(Xt=new DataView(B.memory.buffer)),Xt}function tn(){const e={wbg:{}};return e.wbg.__wbindgen_string_new=function(e,t){return b(P(e,t))},e.wbg.__wbindgen_object_drop_ref=function(e){!function(e){const t=T(e);(function(e){e<132||(R[e]=A,A=e)})(e)}(e)},e.wbg.__wbg_new_abda76e883ba8a5f=function(){return $t((function(){return b(new Error)}),arguments)},e.wbg.__wbg_stack_658279fe44541cf6=function(){return $t((function(e,t){const n=function(e,t,n){if("string"!=typeof e)throw new Error("expected a string argument, found "+typeof e);if(void 0===n){const n=Ht.encode(e),i=t(n.length,1)>>>0;return S().subarray(i,i+n.length).set(n),Jt=n.length,i}let i=e.length,r=t(i,1)>>>0;const o=S();let s=0;for(;s<i;s++){const t=e.charCodeAt(s);if(t>127)break;o[r+s]=t}if(s!==i){0!==s&&(e=e.slice(s)),r=n(r,i,i=s+3*e.length,1)>>>0;const t=S().subarray(r+s,r+i),o=Nt(e,t);if(o.read!==e.length)throw new Error("failed to pass whole string");s+=o.written,r=n(r,i,s,1)>>>0}return Jt=s,r}(T(t).stack,B.__wbindgen_malloc,B.__wbindgen_realloc),i=Jt;en().setInt32(e+4,i,!0),en().setInt32(e+0,n,!0)}),arguments)},e.wbg.__wbg_error_f851667af71bcfc6=function(){return $t((function(e,t){let n,i;try{n=e,i=t,console.error(P(e,t))}finally{B.__wbindgen_free(n,i,1)}}),arguments)},e.wbg.__wbg_error_09480e4aadca50ad=function(){return $t((function(e){console.error(T(e))}),arguments)},e.wbg.__wbg_log_b103404cc5920657=function(){return $t((function(e){console.log(T(e))}),arguments)},e.wbg.__wbindgen_throw=function(e,t){throw new Error(P(e,t))},e}function nn(e,t){return B=e.exports,on.__wbindgen_wasm_module=t,Xt=null,_=null,B}function rn(e){if(void 0!==B)return B;void 0!==e&&Object.getPrototypeOf(e)===Object.prototype?({module:e}=e):console.warn("using deprecated parameters for `initSync()`; pass a single object instead");const t=tn();return e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e)),nn(new WebAssembly.Instance(e,t),e)}async function on(e){if(void 0!==B)return B;void 0!==e&&Object.getPrototypeOf(e)===Object.prototype?({module_or_path:e}=e):console.warn("using deprecated parameters for the initialization function; pass a single object instead"),void 0===e&&(e=new URL(n(4871),n.b));const t=tn();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:i,module:r}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await e,t);return nn(i,r)}const sn=on;var dn=n(6405),an=n(1592),un=n(7648),ln=n(5901),cn=n(3477);class yn{async build(e,t){const n=new y.Z(t);n.clearColor=new a.ov(.95,.95,.95,1);const i=new r.Lq("arcRotateCamera",0,0,500,new u.Pq(0,0,0),n);i.minZ=1,i.maxZ=3e3,i.setPosition(new u.Pq(60,40,-50).scaleInPlace(10)),i.attachControl(void 0,!1),i.inertia=.8,i.speed=10;const B=new s.g("hemisphericLight",new u.Pq(0,1,0),n);B.intensity=.5,B.specular=new a.v9(0,0,0),B.groundColor=new a.v9(1,1,1);const w=new o.Z("directionalLight",new u.Pq(.5,-1,1),n);w.intensity=.5;w.shadowMaxZ=250,w.shadowMinZ=-250,w.autoCalcShadowZBounds=!1,w.autoUpdateExtends=!1,w.shadowOrthoScale=0,w.orthoTop=250,w.orthoBottom=-250,w.orthoLeft=-250,w.orthoRight=250;const _=new d.o(2048,w,!0);_.transparencyShadow=!0,_.usePercentageCloserFiltering=!0,_.forceBackFacesOnly=!1,_.bias=.004,_.filteringQuality=d.o.QUALITY_MEDIUM;const S=await(0,h.e)(new p.t,32),P=new m.h(S,{allowDynamicShadow:!0,preserveBackBuffer:!0});P.register(n),P.evaluationType=g.q.Buffered;const R=new u.uq;{const e=(0,c.x)("ground",{size:500},n);e.rotationQuaternion=u.PT.RotationAxis(new u.Pq(1,0,0),Math.PI/2),_.addShadowCaster(e),e.receiveShadows=!0;const t=new dn.Ty(P,new u.Pq(0,0,-1),0),i=new ln.t(S);i.shape=t,u.uq.FromQuaternionToRef(e.rotationQuaternion,R),i.setInitialTransform(R),i.motionType=1;const r=new an.U(P,i);P.addRigidBodyToGlobal(r)}const A=512,b=(0,l.an)("box",{size:2},n);_.addShadowCaster(b),b.receiveShadows=!0;const T=new Float32Array(262144);b.thinInstanceSetBuffer("matrix",T,16,!1);const G=new dn.SA(P,new u.Pq(1,1,1)),C=[];for(let e=0;e<4;++e)for(let t=0;t<8;++t){const n=8*e+t,i=60*(t-4)+30,r=60*(e-2)+30,o=new cn.x(S,A);for(let e=0;e<A;++e){o.setShape(e,G);const t=u.uq.TranslationToRef(i,1+2*e,r,R);o.setInitialTransform(e,t),o.setFriction(e,1),o.setLinearDamping(e,.3),o.setAngularDamping(e,.3)}const s=new un.Y(P,o);P.addRigidBodyBundle(s,n);for(let e=0;e<A;e+=2){const t=[e,e+1],i=new f.vC(P,s,t,u.uq.Translation(0,-1.2,0),u.uq.Translation(0,1.2,0),!0);i.setLinearLowerLimit(new u.Pq(0,0,0)),i.setLinearUpperLimit(new u.Pq(0,0,0)),i.setAngularLowerLimit(new u.Pq(Math.PI/4,0,0)),i.setAngularUpperLimit(new u.Pq(0,0,0));for(let e=0;e<6;++e)i.enableSpring(e,!0),i.setStiffness(e,100),i.setDamping(e,1);P.addConstraint(i,n,!1)}C.push(s)}return P.onTickObservable.add((()=>{for(let e=0;e<C.length;++e)C[e].getTransformMatricesToArray(T,e*A*16);b.thinInstanceBufferUpdated("matrix")})),n}}}}]);