"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[1992],{1440:(e,s,t)=>{var r=t(9923),n=t(1137),i=t(861),a=t(1812),o=t(4609),h=t(7328),c=t(5616),u=t(998),d=t(6552);a.e._instancedMeshFactory=(e,s)=>{const t=new f(e,s);if(s.instancedBuffers){t.instancedBuffers={};for(const e in s.instancedBuffers)t.instancedBuffers[e]=s.instancedBuffers[e]}return t};class f extends i.u{constructor(e,s){super(e,s.getScene()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,s.addInstance(this),this._sourceMesh=s,this._unIndexed=s._unIndexed,this.position.copyFrom(s.position),this.rotation.copyFrom(s.rotation),this.scaling.copyFrom(s.scaling),s.rotationQuaternion&&(this.rotationQuaternion=s.rotationQuaternion.clone()),this.animations=s.animations.slice();for(const e of s.getAnimationRanges())null!=e&&this.createAnimationRange(e.name,e.from,e.to);this.infiniteDistance=s.infiniteDistance,this.setPivotMatrix(s.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(e){this._sourceMesh?.receiveShadows!==e&&u.S0.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(e){this._sourceMesh?.material!==e&&u.S0.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(e){this._sourceMesh?.visibility!==e&&u.S0.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(e){this._sourceMesh?.skeleton!==e&&u.S0.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&n.V.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get geometry(){return this._sourceMesh._geometry}createInstance(e){return this._sourceMesh.createInstance(e)}isReady(e=!1){return this._sourceMesh.isReady(e,!0)}getVerticesData(e,s,t){return this._sourceMesh.getVerticesData(e,s,t)}copyVerticesData(e,s){this._sourceMesh.copyVerticesData(e,s)}setVerticesData(e,s,t,r){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,s,t,r),this.sourceMesh}updateVerticesData(e,s,t,r){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,s,t,r),this.sourceMesh}setIndices(e,s=null){return this.sourceMesh&&this.sourceMesh.setIndices(e,s),this.sourceMesh}isVerticesDataPresent(e){return this._sourceMesh.isVerticesDataPresent(e)}getIndices(){return this._sourceMesh.getIndices()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(e=!1,s=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let t;t="object"==typeof e?e:{applySkeleton:e,applyMorph:s};const r=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getData(t,null,c.R.PositionKind),r),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(e,s){if(super._activate(e,s),this._sourceMesh.subMeshes||n.V.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!=this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),s){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==h.V.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new r.uq);const e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,r.AA.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(r.AA.Vector3[7]),this._currentLOD._masterMesh=e,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(e){if(!e)return this;const s=this.sourceMesh.getLODLevels();if(s&&0!==s.length){const s=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(e,s.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(e){return this.sourceMesh._preActivateForIntermediateRendering(e)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(let e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}_updateBoundingInfo(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(e,s=null,t,r){const n=(r||this._sourceMesh).createInstance(e);if(o.r.DeepCopy(this,n,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),s&&(n.parent=s),!t)for(let e=0;e<this.getScene().meshes.length;e++){const s=this.getScene().meshes[e];s.parent===this&&s.clone(s.name,n)}return n.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(n),n}dispose(e,s=!1){this._sourceMesh.removeInstance(this),super.dispose(e,s)}_serializeAsParent(e){super._serializeAsParent(e),e.parentId=this._sourceMesh.uniqueId,e.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(e=null,s,t){const r=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0,s&&s.newSourcedMesh);r&&t&&t(this,r);for(const e of this.getChildTransformNodes(!0))e.instantiateHierarchy(r,s,t);return r}}a.e.prototype.registerInstancedBuffer=function(e,s){if(this._userInstancedBuffersStorage?.vertexBuffers[e]?.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const e of this.instances)e.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=s,this._userInstancedBuffersStorage.sizes[e]=32*s,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new c.R(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,s,!0);for(const s of this.instances)s.instancedBuffers[e]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},a.e.prototype._processInstancedBuffers=function(e,s){const t=e?e.length:0;for(const r in this.instancedBuffers){let n=this._userInstancedBuffersStorage.sizes[r];const i=this._userInstancedBuffersStorage.strides[r],a=(t+1)*i;for(;n<a;)n*=2;this._userInstancedBuffersStorage.data[r].length!=n&&(this._userInstancedBuffersStorage.data[r]=new Float32Array(n),this._userInstancedBuffersStorage.sizes[r]=n,this._userInstancedBuffersStorage.vertexBuffers[r]&&(this._userInstancedBuffersStorage.vertexBuffers[r].dispose(),this._userInstancedBuffersStorage.vertexBuffers[r]=null));const o=this._userInstancedBuffersStorage.data[r];let h=0;if(s){const e=this.instancedBuffers[r];e.toArray?e.toArray(o,h):e.copyToArray?e.copyToArray(o,h):o[h]=e,h+=i}for(let s=0;s<t;s++){const t=e[s].instancedBuffers[r];t.toArray?t.toArray(o,h):t.copyToArray?t.copyToArray(o,h):o[h]=t,h+=i}this._userInstancedBuffersStorage.vertexBuffers[r]?this._userInstancedBuffersStorage.vertexBuffers[r].updateDirectly(o,0):(this._userInstancedBuffersStorage.vertexBuffers[r]=new c.R(this.getEngine(),this._userInstancedBuffersStorage.data[r],r,!0,!1,i,!0),this._invalidateInstanceVertexArrayObject())}},a.e.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const e in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[e]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},a.e.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,d.Y5)("BABYLON.InstancedMesh",f)},8121:(e,s,t)=>{t.d(s,{_6:()=>h});var r=t(9923),n=t(1812),i=t(6803),a=t(1313);function o(e){const s=0|(e.segments||32),t=e.diameterX||e.diameter||1,n=e.diameterY||e.diameter||1,o=e.diameterZ||e.diameter||1,h=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,c=e.slice&&e.slice<=0?1:e.slice||1,u=0===e.sideOrientation?0:e.sideOrientation||i.P.DEFAULTSIDE,d=!!e.dedupTopBottomIndices,f=new r.Pq(t/2,n/2,o/2),_=2+s,l=2*_,g=[],p=[],M=[],I=[];for(let e=0;e<=_;e++){const s=e/_,t=s*Math.PI*c;for(let e=0;e<=l;e++){const n=e/l,i=n*Math.PI*2*h,o=r.uq.RotationZ(-t),c=r.uq.RotationY(i),u=r.Pq.TransformCoordinates(r.Pq.Up(),o),d=r.Pq.TransformCoordinates(u,c),_=d.multiply(f),g=d.divide(f).normalize();p.push(_.x,_.y,_.z),M.push(g.x,g.y,g.z),I.push(n,a.rX?1-s:s)}if(e>0){const s=p.length/3;for(let t=s-2*(l+1);t+l+2<s;t++)d?(e>1&&(g.push(t),g.push(t+1),g.push(t+l+1)),(e<_||c<1)&&(g.push(t+l+1),g.push(t+1),g.push(t+l+2))):(g.push(t),g.push(t+1),g.push(t+l+1),g.push(t+l+1),g.push(t+1),g.push(t+l+2))}}i.P._ComputeSides(u,p,g,M,I,e.frontUVs,e.backUVs);const B=new i.P;return B.indices=g,B.positions=p,B.normals=M,B.uvs=I,B}function h(e,s={},t=null){const r=new n.e(e,t);return s.sideOrientation=n.e._GetDefaultSideOrientation(s.sideOrientation),r._originalBuilderSideOrientation=s.sideOrientation,o(s).applyToMesh(r,s.updatable),r}i.P.CreateSphere=o,n.e.CreateSphere=(e,s,t,r,n,i)=>h(e,{segments:s,diameterX:t,diameterY:t,diameterZ:t,sideOrientation:i,updatable:n},r)}}]);