"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[6793],{96793:(i,s,t)=>{t.d(s,{G$:()=>d,KA:()=>a,an:()=>f});var e=t(79923),o=t(26041),n=t(76595),h=t(36803),r=t(91313),u=t(66423);function a(i){let s=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const t=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],n=[];let u=[];const a=i.width||i.size||1,d=i.height||i.size||1,f=i.depth||i.size||1,l=i.wrap||!1;let c=void 0===i.topBaseAt?1:i.topBaseAt,m=void 0===i.bottomBaseAt?0:i.bottomBaseAt;c=(c+4)%4,m=(m+4)%4;let g=[2,0,3,1][c],p=[2,0,1,3][m],b=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(l){s=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],b=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let i=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],t=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const e=[17,18,19,16],o=[22,23,20,21];for(;g>0;)i.unshift(i.pop()),e.unshift(e.pop()),g--;for(;p>0;)t.unshift(t.pop()),o.unshift(o.pop()),p--;i=i.flat(),t=t.flat(),b=b.concat(i).concat(t),s.push(e[0],e[2],e[3],e[0],e[1],e[2]),s.push(o[0],o[2],o[3],o[0],o[1],o[2])}const _=[a/2,d/2,f/2];u=b.reduce(((i,s,t)=>i.concat(s*_[t%3])),[]);const v=0===i.sideOrientation?0:i.sideOrientation||h.P.DEFAULTSIDE,w=i.faceUV||new Array(6),x=i.faceColors,y=[];for(let i=0;i<6;i++)void 0===w[i]&&(w[i]=new e.IU(0,0,1,1)),x&&void 0===x[i]&&(x[i]=new o.ov(1,1,1,1));for(let i=0;i<6;i++)if(n.push(w[i].z,r.rX?1-w[i].w:w[i].w),n.push(w[i].x,r.rX?1-w[i].w:w[i].w),n.push(w[i].x,r.rX?1-w[i].y:w[i].y),n.push(w[i].z,r.rX?1-w[i].y:w[i].y),x)for(let s=0;s<4;s++)y.push(x[i].r,x[i].g,x[i].b,x[i].a);h.P._ComputeSides(v,u,s,t,n,i.frontUVs,i.backUVs);const z=new h.P;if(z.indices=s,z.positions=u,z.normals=t,z.uvs=n,x){const i=v===h.P.DOUBLESIDE?y.concat(y):y;z.colors=i}return z}function d(i){const s=i.width||i.size||1,t=i.height||i.size||1,o=i.depth||i.size||1,n=0|(i.widthSegments||i.segments||1),h=0|(i.heightSegments||i.segments||1),r=0|(i.depthSegments||i.segments||1),a=new e.uq,d=new e.uq,f=new e.uq,l=(0,u.EH)({width:s,height:o,subdivisionsX:n,subdivisionsY:r});e.uq.TranslationToRef(0,-t/2,0,d),e.uq.RotationZToRef(Math.PI,a),a.multiplyToRef(d,f),l.transform(f);const c=(0,u.EH)({width:s,height:o,subdivisionsX:n,subdivisionsY:r});e.uq.TranslationToRef(0,t/2,0,f),c.transform(f);const m=(0,u.EH)({width:t,height:o,subdivisionsX:h,subdivisionsY:r});e.uq.TranslationToRef(-s/2,0,0,d),e.uq.RotationZToRef(Math.PI/2,a),a.multiplyToRef(d,f),m.transform(f);const g=(0,u.EH)({width:t,height:o,subdivisionsX:h,subdivisionsY:r});e.uq.TranslationToRef(s/2,0,0,d),e.uq.RotationZToRef(-Math.PI/2,a),a.multiplyToRef(d,f),g.transform(f);const p=(0,u.EH)({width:s,height:t,subdivisionsX:n,subdivisionsY:h});e.uq.TranslationToRef(0,0,-o/2,d),e.uq.RotationXToRef(-Math.PI/2,a),a.multiplyToRef(d,f),p.transform(f);const b=(0,u.EH)({width:s,height:t,subdivisionsX:n,subdivisionsY:h});return e.uq.TranslationToRef(0,0,o/2,d),e.uq.RotationXToRef(Math.PI/2,a),a.multiplyToRef(d,f),b.transform(f),l.merge([c,g,m,p,b],!0),l}function f(i,s={},t=null){const e=new n.e(i,t);return s.sideOrientation=n.e._GetDefaultSideOrientation(s.sideOrientation),e._originalBuilderSideOrientation=s.sideOrientation,a(s).applyToMesh(e,s.updatable),e}h.P.CreateBox=a,n.e.CreateBox=(i,s,t=null,e,o)=>f(i,{size:s,sideOrientation:o,updatable:e},t)},66423:(i,s,t)=>{t.d(s,{EH:()=>l,RI:()=>b,km:()=>g,ol:()=>p});var e=t(79923),o=t(26041),n=t(76595),h=t(36803),r=t(11420),u=t(998),a=t(6315),d=t(65559),f=t(91313);function l(i){const s=[],t=[],o=[],n=[];let r,u;const a=i.width||i.size||1,d=i.height||i.size||1,l=0|(i.subdivisionsX||i.subdivisions||1),c=0|(i.subdivisionsY||i.subdivisions||1);for(r=0;r<=c;r++)for(u=0;u<=l;u++){const i=new e.Pq(u*a/l-a/2,0,(c-r)*d/c-d/2),s=new e.Pq(0,1,0);t.push(i.x,i.y,i.z),o.push(s.x,s.y,s.z),n.push(u/l,f.rX?r/c:1-r/c)}for(r=0;r<c;r++)for(u=0;u<l;u++)s.push(u+1+(r+1)*(l+1)),s.push(u+1+r*(l+1)),s.push(u+r*(l+1)),s.push(u+(r+1)*(l+1)),s.push(u+1+(r+1)*(l+1)),s.push(u+r*(l+1));const m=new h.P;return m.indices=s,m.positions=t,m.normals=o,m.uvs=n,m}function c(i){const s=void 0!==i.xmin&&null!==i.xmin?i.xmin:-1,t=void 0!==i.zmin&&null!==i.zmin?i.zmin:-1,o=void 0!==i.xmax&&null!==i.xmax?i.xmax:1,n=void 0!==i.zmax&&null!==i.zmax?i.zmax:1,r=i.subdivisions||{w:1,h:1},u=i.precision||{w:1,h:1},a=[],d=[],f=[],l=[];let c,m,g,p;r.h=r.h<1?1:r.h,r.w=r.w<1?1:r.w,u.w=u.w<1?1:u.w,u.h=u.h<1?1:u.h;const b=(o-s)/r.w,_=(n-t)/r.h;function v(i,s,t,o){const n=d.length/3,h=u.w+1;for(c=0;c<u.h;c++)for(m=0;m<u.w;m++){const i=[n+m+c*h,n+(m+1)+c*h,n+(m+1)+(c+1)*h,n+m+(c+1)*h];a.push(i[1]),a.push(i[2]),a.push(i[3]),a.push(i[0]),a.push(i[1]),a.push(i[3])}const r=e.Pq.Zero(),g=new e.Pq(0,1,0);for(c=0;c<=u.h;c++)for(r.z=c*(o-s)/u.h+s,m=0;m<=u.w;m++)r.x=m*(t-i)/u.w+i,r.y=0,d.push(r.x,r.y,r.z),f.push(g.x,g.y,g.z),l.push(m/u.w,c/u.h)}for(g=0;g<r.h;g++)for(p=0;p<r.w;p++)v(s+p*b,t+g*_,s+(p+1)*b,t+(g+1)*_);const w=new h.P;return w.indices=a,w.positions=d,w.normals=f,w.uvs=l,w}function m(i){const s=[],t=[],n=[],r=[];let u,a;const f=i.colorFilter||new o.v9(.3,.59,.11),l=i.alphaFilter||0;let c=!1;if(i.minHeight>i.maxHeight){c=!0;const s=i.maxHeight;i.maxHeight=i.minHeight,i.minHeight=s}for(u=0;u<=i.subdivisions;u++)for(a=0;a<=i.subdivisions;a++){const s=new e.Pq(a*i.width/i.subdivisions-i.width/2,0,(i.subdivisions-u)*i.height/i.subdivisions-i.height/2),o=4*(((s.x+i.width/2)/i.width*(i.bufferWidth-1)|0)+((1-(s.z+i.height/2)/i.height)*(i.bufferHeight-1)|0)*i.bufferWidth);let h=i.buffer[o]/255,m=i.buffer[o+1]/255,g=i.buffer[o+2]/255;const p=i.buffer[o+3]/255;c&&(h=1-h,m=1-m,g=1-g);const b=h*f.r+m*f.g+g*f.b;s.y=p>=l?i.minHeight+(i.maxHeight-i.minHeight)*b:i.minHeight-d.bH,i.heightBuffer&&(i.heightBuffer[u*(i.subdivisions+1)+a]=s.y),t.push(s.x,s.y,s.z),n.push(0,0,0),r.push(a/i.subdivisions,1-u/i.subdivisions)}for(u=0;u<i.subdivisions;u++)for(a=0;a<i.subdivisions;a++){const e=a+1+(u+1)*(i.subdivisions+1),o=a+1+u*(i.subdivisions+1),n=a+u*(i.subdivisions+1),h=a+(u+1)*(i.subdivisions+1),r=t[3*e+1]>=i.minHeight,d=t[3*o+1]>=i.minHeight,f=t[3*n+1]>=i.minHeight;r&&d&&f&&(s.push(e),s.push(o),s.push(n)),t[3*h+1]>=i.minHeight&&r&&f&&(s.push(h),s.push(e),s.push(n))}h.P.ComputeNormals(t,s,n);const m=new h.P;return m.indices=s,m.positions=t,m.normals=n,m.uvs=r,m}function g(i,s={},t){const e=new r.f(i,t);return e._setReady(!1),e._subdivisionsX=s.subdivisionsX||s.subdivisions||1,e._subdivisionsY=s.subdivisionsY||s.subdivisions||1,e._width=s.width||1,e._height=s.height||1,e._maxX=e._width/2,e._maxZ=e._height/2,e._minX=-e._maxX,e._minZ=-e._maxZ,l(s).applyToMesh(e,s.updatable),e._setReady(!0),e}function p(i,s,t=null){const e=new n.e(i,t);return c(s).applyToMesh(e,s.updatable),e}function b(i,s,t={},e=null){const n=t.width||10,h=t.height||10,d=t.subdivisions||1,f=t.minHeight||0,l=t.maxHeight||1,c=t.colorFilter||new o.v9(.3,.59,.11),g=t.alphaFilter||0,p=t.updatable,b=t.onReady;e=e||a.q.LastCreatedScene;const _=new r.f(i,e);let v;_._subdivisionsX=d,_._subdivisionsY=d,_._width=n,_._height=h,_._maxX=_._width/2,_._maxZ=_._height/2,_._minX=-_._maxX,_._minZ=-_._maxZ,_._setReady(!1),t.passHeightBufferInCallback&&(v=new Float32Array((d+1)*(d+1)));const w=(i,s,t)=>{m({width:n,height:h,subdivisions:d,minHeight:f,maxHeight:l,colorFilter:c,buffer:i,bufferWidth:s,bufferHeight:t,alphaFilter:g,heightBuffer:v}).applyToMesh(_,p),b&&b(_,v),_._setReady(!0)};if("string"==typeof s){const i=i=>{const s=i.width,t=i.height;if(e.isDisposed)return;const o=e?.getEngine().resizeImageBitmap(i,s,t);w(o,s,t)};u.S0.LoadImage(s,i,t.onError?t.onError:()=>{},e.offlineProvider)}else w(s.data,s.width,s.height);return _}h.P.CreateGround=l,h.P.CreateTiledGround=c,h.P.CreateGroundFromHeightMap=m,n.e.CreateGround=(i,s,t,e,o,n)=>g(i,{width:s,height:t,subdivisions:e,updatable:n},o),n.e.CreateTiledGround=(i,s,t,e,o,n,h,r,u)=>p(i,{xmin:s,zmin:t,xmax:e,zmax:o,subdivisions:n,precision:h,updatable:u},r),n.e.CreateGroundFromHeightMap=(i,s,t,e,o,n,h,r,u,a,d)=>b(i,s,{width:t,height:e,subdivisions:o,minHeight:n,maxHeight:h,updatable:u,onReady:a,alphaFilter:d},r)},11420:(i,s,t)=>{t.d(s,{f:()=>h});var e=t(79923),o=t(95616),n=t(76595);n.e._GroundMeshParser=(i,s)=>h.Parse(i,s);class h extends n.e{constructor(i,s){super(i,s),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(i,s=32){this._subdivisionsX=i,this._subdivisionsY=i,this.subdivide(i);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(s)}getHeightAtCoordinates(i,s){const t=this.getWorldMatrix(),o=e.AA.Matrix[5];t.invertToRef(o);const n=e.AA.Vector3[8];if(e.Pq.TransformCoordinatesFromFloatsToRef(i,0,s,o,n),i=n.x,s=n.z,i<this._minX||i>=this._maxX||s<=this._minZ||s>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const h=this._getFacetAt(i,s),r=-(h.x*i+h.z*s+h.w)/h.y;return e.Pq.TransformCoordinatesFromFloatsToRef(0,r,0,t,n),n.y}getNormalAtCoordinates(i,s){const t=new e.Pq(0,1,0);return this.getNormalAtCoordinatesToRef(i,s,t),t}getNormalAtCoordinatesToRef(i,s,t){const o=this.getWorldMatrix(),n=e.AA.Matrix[5];o.invertToRef(n);const h=e.AA.Vector3[8];if(e.Pq.TransformCoordinatesFromFloatsToRef(i,0,s,n,h),i=h.x,s=h.z,i<this._minX||i>this._maxX||s<this._minZ||s>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const r=this._getFacetAt(i,s);return e.Pq.TransformNormalFromFloatsToRef(r.x,r.y,r.z,o,t),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(i,s){const t=Math.floor((i+this._maxX)*this._subdivisionsX/this._width),e=Math.floor(-(s+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),o=this._heightQuads[e*this._subdivisionsX+t];let n;return n=s<o.slope.x*i+o.slope.y?o.facet1:o.facet2,n}_initHeightQuads(){const i=this._subdivisionsX,s=this._subdivisionsY;this._heightQuads=new Array;for(let t=0;t<s;t++)for(let s=0;s<i;s++){const o={slope:e.I9.Zero(),facet1:new e.IU(0,0,0,0),facet2:new e.IU(0,0,0,0)};this._heightQuads[t*i+s]=o}return this}_computeHeightQuads(){const i=this.getVerticesData(o.R.PositionKind);if(!i)return this;const s=e.AA.Vector3[3],t=e.AA.Vector3[2],n=e.AA.Vector3[1],h=e.AA.Vector3[0],r=e.AA.Vector3[4],u=e.AA.Vector3[5],a=e.AA.Vector3[6],d=e.AA.Vector3[7],f=e.AA.Vector3[8];let l=0,c=0,m=0,g=0,p=0,b=0,_=0;const v=this._subdivisionsX,w=this._subdivisionsY;for(let o=0;o<w;o++)for(let w=0;w<v;w++){l=3*w,c=o*(v+1)*3,m=(o+1)*(v+1)*3,s.x=i[c+l],s.y=i[c+l+1],s.z=i[c+l+2],t.x=i[c+l+3],t.y=i[c+l+4],t.z=i[c+l+5],n.x=i[m+l],n.y=i[m+l+1],n.z=i[m+l+2],h.x=i[m+l+3],h.y=i[m+l+4],h.z=i[m+l+5],g=(h.z-s.z)/(h.x-s.x),p=s.z-g*s.x,t.subtractToRef(s,r),n.subtractToRef(s,u),h.subtractToRef(s,a),e.Pq.CrossToRef(a,u,d),e.Pq.CrossToRef(r,a,f),d.normalize(),f.normalize(),b=-(d.x*s.x+d.y*s.y+d.z*s.z),_=-(f.x*t.x+f.y*t.y+f.z*t.z);const x=this._heightQuads[o*v+w];x.slope.copyFromFloats(g,p),x.facet1.copyFromFloats(d.x,d.y,d.z,b),x.facet2.copyFromFloats(f.x,f.y,f.z,_)}return this}serialize(i){super.serialize(i),i.subdivisionsX=this._subdivisionsX,i.subdivisionsY=this._subdivisionsY,i.minX=this._minX,i.maxX=this._maxX,i.minZ=this._minZ,i.maxZ=this._maxZ,i.width=this._width,i.height=this._height}static Parse(i,s){const t=new h(i.name,s);return t._subdivisionsX=i.subdivisionsX||1,t._subdivisionsY=i.subdivisionsY||1,t._minX=i.minX,t._maxX=i.maxX,t._minZ=i.minZ,t._maxZ=i.maxZ,t._width=i.width,t._height=i.height,t}}}}]);