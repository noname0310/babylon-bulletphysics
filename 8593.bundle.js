"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[8593],{825:(s,i,t)=>{t.d(i,{cL:()=>r});var e=t(9923);class n{constructor(s,i){if(this._pluginData=void 0,this._isTrigger=!1,this._isDisposed=!1,!i)return;const t=i.getPhysicsEngine();if(!t)throw new Error("No Physics Engine available.");if(2!=t.getPluginVersion())throw new Error("Plugin version is incorrect. Expected version 2.");const e=t.getPhysicsPlugin();if(!e)throw new Error("No Physics Plugin available.");if(this._physicsPlugin=e,void 0!==s.pluginData&&null!==s.pluginData)this._pluginData=s.pluginData,this._type=this._physicsPlugin.getShapeType(this);else if(void 0!==s.type&&null!==s.type){this._type=s.type;const i=s.parameters??{};this._physicsPlugin.initShape(this,s.type,i)}}getClassName(){return"PhysicsShape"}get type(){return this._type}set filterMembershipMask(s){this._physicsPlugin.setShapeFilterMembershipMask(this,s)}get filterMembershipMask(){return this._physicsPlugin.getShapeFilterMembershipMask(this)}set filterCollideMask(s){this._physicsPlugin.setShapeFilterCollideMask(this,s)}get filterCollideMask(){return this._physicsPlugin.getShapeFilterCollideMask(this)}set material(s){this._physicsPlugin.setMaterial(this,s),this._material=s}get material(){return this._material||(this._material=this._physicsPlugin.getMaterial(this)),this._material}set density(s){this._physicsPlugin.setDensity(this,s)}get density(){return this._physicsPlugin.getDensity(this)}addChildFromParent(s,i,t){const n=t.computeWorldMatrix(!0),r=s.computeWorldMatrix(!0),h=e.AA.Matrix[0];n.multiplyToRef(e.uq.Invert(r),h);const o=e.AA.Vector3[0],l=e.AA.Quaternion[0],a=e.AA.Vector3[1];h.decompose(a,l,o),this._physicsPlugin.addChild(this,i,o,l,a)}addChild(s,i,t,e){this._physicsPlugin.addChild(this,s,i,t,e)}removeChild(s){this._physicsPlugin.removeChild(this,s)}getNumChildren(){return this._physicsPlugin.getNumChildren(this)}getBoundingBox(){return this._physicsPlugin.getBoundingBox(this)}set isTrigger(s){this._isTrigger!==s&&(this._isTrigger=s,this._physicsPlugin.setTrigger(this,s))}get isTrigger(){return this._isTrigger}dispose(){this._isDisposed||(this._physicsPlugin.disposeShape(this),this._isDisposed=!0)}}class r extends n{constructor(s,i,t,e){super({type:3,parameters:{center:s,rotation:i,extents:t}},e)}static FromMesh(s){const i=s.getBoundingInfo(),t=i.boundingBox.center,n=i.boundingBox.extendSize.scale(2);return new r(t,e.PT.Identity(),n,s.getScene())}}},3108:(s,i,t)=>{var e=t(1137),n=t(9848),r=t(6945),h=t(554),o=t(9923),l=t(5503);class a{getPluginVersion(){return this._physicsPlugin.getPluginVersion()}static DefaultPluginFactory(){throw(0,l.n)("CannonJSPlugin")}constructor(s,i=a.DefaultPluginFactory()){if(this._physicsPlugin=i,this._impostors=[],this._joints=[],this._subTimeStep=0,this._uniqueIdCounter=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");s=s||new o.Pq(0,-9.807,0),this.setGravity(s),this.setTimeStep()}setGravity(s){this.gravity=s,this._physicsPlugin.setGravity(this.gravity)}setTimeStep(s=1/60){this._physicsPlugin.setTimeStep(s)}getTimeStep(){return this._physicsPlugin.getTimeStep()}setSubTimeStep(s=0){this._subTimeStep=s}getSubTimeStep(){return this._subTimeStep}dispose(){this._impostors.forEach((function(s){s.dispose()})),this._physicsPlugin.dispose()}getPhysicsPluginName(){return this._physicsPlugin.name}addImpostor(s){this._impostors.push(s),s.uniqueId=this._uniqueIdCounter++,s.parent||this._physicsPlugin.generatePhysicsBody(s)}removeImpostor(s){const i=this._impostors.indexOf(s);i>-1&&this._impostors.splice(i,1).length&&this.getPhysicsPlugin().removePhysicsBody(s)}addJoint(s,i,t){const e={mainImpostor:s,connectedImpostor:i,joint:t};t.physicsPlugin=this._physicsPlugin,this._joints.push(e),this._physicsPlugin.generateJoint(e)}removeJoint(s,i,t){const e=this._joints.filter((function(e){return e.connectedImpostor===i&&e.joint===t&&e.mainImpostor===s}));e.length&&this._physicsPlugin.removeJoint(e[0])}_step(s){this._impostors.forEach((s=>{s.isBodyInitRequired()&&this._physicsPlugin.generatePhysicsBody(s)})),s>.1?s=.1:s<=0&&(s=1/60),this._physicsPlugin.executeStep(s,this._impostors)}getPhysicsPlugin(){return this._physicsPlugin}getImpostors(){return this._impostors}getImpostorForPhysicsObject(s){for(let i=0;i<this._impostors.length;++i)if(this._impostors[i].object===s)return this._impostors[i];return null}getImpostorWithPhysicsBody(s){for(let i=0;i<this._impostors.length;++i)if(this._impostors[i].physicsBody===s)return this._impostors[i];return null}raycast(s,i){return this._physicsPlugin.raycast(s,i)}raycastToRef(s,i,t){return this._physicsPlugin.raycastToRef(s,i,t)}}class c{constructor(){this._hasHit=!1,this._hitNormal=o.Pq.Zero(),this._hitPoint=o.Pq.Zero(),this._triangleIndex=-1}get hitPoint(){return this._hitPoint}get hitNormal(){return this._hitNormal}get hasHit(){return this._hasHit}get triangleIndex(){return this._triangleIndex}setHitData(s,i,t){this._hasHit=!0,this._hitNormal.set(s.x,s.y,s.z),this._hitPoint.set(i.x,i.y,i.z),this._triangleIndex=t??-1}reset(){this._hasHit=!1,this._hitNormal.setAll(0),this._hitPoint.setAll(0),this._triangleIndex=-1,this.body=void 0,this.bodyIndex=void 0,this.shape=void 0}}class p extends c{constructor(){super(...arguments),this._hitDistance=0,this._rayFromWorld=o.Pq.Zero(),this._rayToWorld=o.Pq.Zero()}get hitDistance(){return this._hitDistance}get hitNormalWorld(){return this._hitNormal}get hitPointWorld(){return this._hitPoint}get rayFromWorld(){return this._rayFromWorld}get rayToWorld(){return this._rayToWorld}setHitDistance(s){this._hitDistance=s}calculateHitDistance(){this._hitDistance=o.Pq.Distance(this._rayFromWorld,this._hitPoint)}reset(s=o.Pq.Zero(),i=o.Pq.Zero()){super.reset(),this._rayFromWorld.copyFrom(s),this._rayToWorld.copyFrom(i),this._hitDistance=0}}class u{getPluginVersion(){return this._physicsPlugin.getPluginVersion()}static DefaultPluginFactory(){throw(0,l.n)("")}constructor(s,i=u.DefaultPluginFactory()){this._physicsPlugin=i,this._physicsBodies=[],this._subTimeStep=0,s=s||new o.Pq(0,-9.807,0),this.setGravity(s),this.setTimeStep()}setGravity(s){this.gravity=s,this._physicsPlugin.setGravity(this.gravity)}setTimeStep(s=1/60){this._physicsPlugin.setTimeStep(s)}getTimeStep(){return this._physicsPlugin.getTimeStep()}setSubTimeStep(s=0){this._subTimeStep=s}getSubTimeStep(){return this._subTimeStep}dispose(){this._physicsPlugin.dispose()}getPhysicsPluginName(){return this._physicsPlugin.name}setVelocityLimits(s,i){this._physicsPlugin.setVelocityLimits(s,i)}getMaxLinearVelocity(){return this._physicsPlugin.getMaxLinearVelocity()}getMaxAngularVelocity(){return this._physicsPlugin.getMaxAngularVelocity()}_step(s){s>.1?s=.1:s<=0&&(s=1/60),this._physicsPlugin.executeStep(s,this._physicsBodies)}addBody(s){this._physicsBodies.push(s)}removeBody(s){const i=this._physicsBodies.indexOf(s);i>-1&&this._physicsBodies.splice(i,1)}getBodies(){return this._physicsBodies}getPhysicsPlugin(){return this._physicsPlugin}raycastToRef(s,i,t,e){this._physicsPlugin.raycast(s,i,t,e)}raycast(s,i,t){const e=new p;return this._physicsPlugin.raycast(s,i,e,t),e}}h.Z.prototype.getPhysicsEngine=function(){return this._physicsEngine},h.Z.prototype.enablePhysics=function(s=null,i){if(this._physicsEngine)return!0;let t=this._getComponent(r.v.NAME_PHYSICSENGINE);t||(t=new g(this),this._addComponent(t));try{if(i&&1!==i?.getPluginVersion()){if(2!==i?.getPluginVersion())throw new Error("Unsupported Physics plugin version.");this._physicsEngine=new u(s,i)}else this._physicsEngine=new a(s,i);return this._physicsTimeAccumulator=0,!0}catch(s){return e.V.Error(s.message),!1}},h.Z.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},h.Z.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},h.Z.prototype.deleteCompoundImpostor=function(s){const i=s.parts[0].mesh;i.physicsImpostor&&(i.physicsImpostor.dispose(),i.physicsImpostor=null)},h.Z.prototype._advancePhysicsEngineStep=function(s){if(this._physicsEngine){const i=this._physicsEngine.getSubTimeStep();if(i>0)for(this._physicsTimeAccumulator+=s;this._physicsTimeAccumulator>i;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(i/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=i;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(s/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}};class g{constructor(s){this.name=r.v.NAME_PHYSICSENGINE,this.scene=s,this.scene.onBeforePhysicsObservable=new n.cP,this.scene.onAfterPhysicsObservable=new n.cP,this.scene.getDeterministicFrameTime=()=>this.scene._physicsEngine?1e3*this.scene._physicsEngine.getTimeStep():1e3/60}register(){}rebuild(){}dispose(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()}}},3490:(s,i,t)=>{var e,n,r,h,o,l,a,c,p;t.d(i,{AH:()=>a,DK:()=>h,f9:()=>c}),function(s){s[s.FREE=0]="FREE",s[s.LIMITED=1]="LIMITED",s[s.LOCKED=2]="LOCKED"}(e||(e={})),function(s){s[s.LINEAR_X=0]="LINEAR_X",s[s.LINEAR_Y=1]="LINEAR_Y",s[s.LINEAR_Z=2]="LINEAR_Z",s[s.ANGULAR_X=3]="ANGULAR_X",s[s.ANGULAR_Y=4]="ANGULAR_Y",s[s.ANGULAR_Z=5]="ANGULAR_Z",s[s.LINEAR_DISTANCE=6]="LINEAR_DISTANCE"}(n||(n={})),function(s){s[s.BALL_AND_SOCKET=1]="BALL_AND_SOCKET",s[s.DISTANCE=2]="DISTANCE",s[s.HINGE=3]="HINGE",s[s.SLIDER=4]="SLIDER",s[s.LOCK=5]="LOCK",s[s.PRISMATIC=6]="PRISMATIC",s[s.SIX_DOF=7]="SIX_DOF"}(r||(r={})),function(s){s[s.SPHERE=0]="SPHERE",s[s.CAPSULE=1]="CAPSULE",s[s.CYLINDER=2]="CYLINDER",s[s.BOX=3]="BOX",s[s.CONVEX_HULL=4]="CONVEX_HULL",s[s.CONTAINER=5]="CONTAINER",s[s.MESH=6]="MESH",s[s.HEIGHTFIELD=7]="HEIGHTFIELD"}(h||(h={})),function(s){s[s.NONE=0]="NONE",s[s.VELOCITY=1]="VELOCITY",s[s.POSITION=2]="POSITION"}(o||(o={})),function(s){s.COLLISION_STARTED="COLLISION_STARTED",s.COLLISION_CONTINUED="COLLISION_CONTINUED",s.COLLISION_FINISHED="COLLISION_FINISHED",s.TRIGGER_ENTERED="TRIGGER_ENTERED",s.TRIGGER_EXITED="TRIGGER_EXITED"}(l||(l={})),function(s){s[s.STATIC=0]="STATIC",s[s.ANIMATED=1]="ANIMATED",s[s.DYNAMIC=2]="DYNAMIC"}(a||(a={})),function(s){s[s.DISABLED=0]="DISABLED",s[s.TELEPORT=1]="TELEPORT",s[s.ACTION=2]="ACTION"}(c||(c={})),function(s){s[s.SIMULATION_CONTROLLED=0]="SIMULATION_CONTROLLED",s[s.ALWAYS_ACTIVE=1]="ALWAYS_ACTIVE",s[s.ALWAYS_INACTIVE=2]="ALWAYS_INACTIVE"}(p||(p={}))},5431:(s,i,t)=>{var e;t.d(i,{F:()=>e}),function(s){s[s.GEOMETRIC_MEAN=0]="GEOMETRIC_MEAN",s[s.MINIMUM=1]="MINIMUM",s[s.MAXIMUM=2]="MAXIMUM",s[s.ARITHMETIC_MEAN=3]="ARITHMETIC_MEAN",s[s.MULTIPLY=4]="MULTIPLY"}(e||(e={}))},8014:(s,i,t)=>{t.d(i,{a:()=>r});var e=t(3490),n=t(9923);class r{get disablePreStep(){return this._prestepType==e.f9.DISABLED}set disablePreStep(s){this._prestepType=s?e.f9.DISABLED:e.f9.TELEPORT}constructor(s,i,t,r){if(this._pluginData=void 0,this._pluginDataInstances=[],this._collisionCBEnabled=!1,this._collisionEndedCBEnabled=!1,this.disableSync=!1,this._isDisposed=!1,this._shape=null,this._prestepType=e.f9.DISABLED,!r)return;const h=r.getPhysicsEngine();if(!h)throw new Error("No Physics Engine available.");if(this._physicsEngine=h,2!=h.getPluginVersion())throw new Error("Plugin version is incorrect. Expected version 2.");const o=h.getPhysicsPlugin();if(!o)throw new Error("No Physics Plugin available.");this._physicsPlugin=o,s.rotationQuaternion||(s.rotationQuaternion=n.PT.FromEulerAngles(s.rotation.x,s.rotation.y,s.rotation.z)),this.startAsleep=t,this._motionType=i,this.disableSync=0==i;const l=s;l.hasThinInstances?this._physicsPlugin.initBodyInstances(this,i,l):(s.parent&&s.computeWorldMatrix(!0),this._physicsPlugin.initBody(this,i,s.absolutePosition,s.absoluteRotationQuaternion)),this.transformNode=s,s.physicsBody=this,h.addBody(this),this._nodeDisposeObserver=s.onDisposeObservable.add((()=>{this.dispose()}))}getClassName(){return"PhysicsBody"}clone(s){const i=new r(s,this.getMotionType(),this.startAsleep,this.transformNode.getScene());return i.shape=this.shape,i.setMassProperties(this.getMassProperties()),i.setLinearDamping(this.getLinearDamping()),i.setAngularDamping(this.getAngularDamping()),i}updateBodyInstances(){const s=this.transformNode;s.hasThinInstances&&this._physicsPlugin.updateBodyInstances(this,s)}get numInstances(){return this._pluginDataInstances.length}get motionType(){return this._motionType}set shape(s){this._shape=s,s&&this._physicsPlugin.setShape(this,s)}get shape(){return this._shape}getBoundingBox(){return this._physicsPlugin.getBodyBoundingBox(this)}setEventMask(s,i){this._physicsPlugin.setEventMask(this,s,i)}getEventMask(s){return this._physicsPlugin.getEventMask(this,s)}setMotionType(s,i){this.disableSync=0==s,this._physicsPlugin.setMotionType(this,s,i)}getMotionType(s){return this._physicsPlugin.getMotionType(this,s)}setPrestepType(s){this._prestepType=s}getPrestepType(){return this._prestepType}computeMassProperties(s){return this._physicsPlugin.computeMassProperties(this,s)}setMassProperties(s,i){this._physicsPlugin.setMassProperties(this,s,i)}getMassProperties(s){return this._physicsPlugin.getMassProperties(this,s)}setLinearDamping(s,i){this._physicsPlugin.setLinearDamping(this,s,i)}getLinearDamping(s){return this._physicsPlugin.getLinearDamping(this,s)}setAngularDamping(s,i){this._physicsPlugin.setAngularDamping(this,s,i)}getAngularDamping(s){return this._physicsPlugin.getAngularDamping(this,s)}setLinearVelocity(s,i){this._physicsPlugin.setLinearVelocity(this,s,i)}getLinearVelocityToRef(s,i){this._physicsPlugin.getLinearVelocityToRef(this,s,i)}getLinearVelocity(s){const i=new n.Pq;return this.getLinearVelocityToRef(i,s),i}setAngularVelocity(s,i){this._physicsPlugin.setAngularVelocity(this,s,i)}getAngularVelocityToRef(s,i){this._physicsPlugin.getAngularVelocityToRef(this,s,i)}getAngularVelocity(s){const i=new n.Pq;return this.getAngularVelocityToRef(i,s),i}applyImpulse(s,i,t){this._physicsPlugin.applyImpulse(this,s,i,t)}applyAngularImpulse(s,i){this._physicsPlugin.applyAngularImpulse(this,s,i)}applyForce(s,i,t){this._physicsPlugin.applyForce(this,s,i,t)}getGeometry(){return this._physicsPlugin.getBodyGeometry(this)}getCollisionObservable(){return this._physicsPlugin.getCollisionObservable(this)}getCollisionEndedObservable(){return this._physicsPlugin.getCollisionEndedObservable(this)}setCollisionCallbackEnabled(s){this._collisionCBEnabled=s,this._physicsPlugin.setCollisionCallbackEnabled(this,s)}setCollisionEndedCallbackEnabled(s){this._collisionEndedCBEnabled=s,this._physicsPlugin.setCollisionEndedCallbackEnabled(this,s)}getObjectCenterWorld(s){const i=new n.Pq;return this.getObjectCenterWorldToRef(i,s)}getObjectCenterWorldToRef(s,i){if(this._pluginDataInstances?.length>0){const t=i||0,e=this.transformNode._thinInstanceDataStorage.matrixData;e&&s.set(e[16*t+12],e[16*t+13],e[16*t+14])}else s.copyFrom(this.transformNode.position);return s}addConstraint(s,i,t,e){this._physicsPlugin.addConstraint(this,s,i,t,e)}syncWithBone(s,i,t,e,r,h){const o=this.transformNode;if(o.rotationQuaternion)if(r){const t=n.AA.Quaternion[0];s.getRotationQuaternionToRef(1,i,t),t.multiplyToRef(r,o.rotationQuaternion)}else s.getRotationQuaternionToRef(1,i,o.rotationQuaternion);const l=n.AA.Vector3[0],a=n.AA.Vector3[1];h||((h=n.AA.Vector3[2]).x=0,h.y=1,h.z=0),s.getDirectionToRef(h,i,a),s.getAbsolutePositionToRef(i,l),null==e&&t&&(e=t.length()),null!=e&&(l.x+=a.x*e,l.y+=a.y*e,l.z+=a.z*e),o.setAbsolutePosition(l)}iterateOverAllInstances(s){if(this._pluginDataInstances?.length>0)for(let i=0;i<this._pluginDataInstances.length;i++)s(this,i);else s(this,void 0)}setGravityFactor(s,i){this._physicsPlugin.setGravityFactor(this,s,i)}getGravityFactor(s){return this._physicsPlugin.getGravityFactor(this,s)}setTargetTransform(s,i,t){this._physicsPlugin.setTargetTransform(this,s,i,t)}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._collisionCBEnabled&&this.setCollisionCallbackEnabled(!1),this._collisionEndedCBEnabled&&this.setCollisionEndedCallbackEnabled(!1),this._nodeDisposeObserver&&(this.transformNode.onDisposeObservable.remove(this._nodeDisposeObserver),this._nodeDisposeObserver=null),this._physicsEngine.removeBody(this),this._physicsPlugin.removeBody(this),this._physicsPlugin.disposeBody(this),this.transformNode.physicsBody=null,this._pluginData=null,this._pluginDataInstances.length=0,this._isDisposed=!0,this.shape=null)}}}}]);