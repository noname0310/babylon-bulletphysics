"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[4361],{36755:(e,t,n)=>{n.d(t,{d:()=>d});var a=n(79923),r=n(84867),s=n(77517),i=n(65559),o=n(26041);class l{constructor(e,t,n,a){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=n,this.worldAxisForFileY=a}}class d{static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();const t=e.getSize().width,n=e.readPixels(0,void 0,void 0,!1),a=e.readPixels(1,void 0,void 0,!1);let r,s;e.isRenderTarget?(r=e.readPixels(3,void 0,void 0,!1),s=e.readPixels(2,void 0,void 0,!1)):(r=e.readPixels(2,void 0,void 0,!1),s=e.readPixels(3,void 0,void 0,!1));const i=e.readPixels(4,void 0,void 0,!1),o=e.readPixels(5,void 0,void 0,!1),l=e.gammaSpace;let d=0;return 1!=e.textureType&&2!=e.textureType||(d=1),new Promise((e=>{Promise.all([a,n,r,s,i,o]).then((([n,a,r,s,i,o])=>{const c={size:t,right:a,left:n,up:r,down:s,front:i,back:o,format:5,type:d,gammaSpace:l};e(this.ConvertCubeMapToSphericalPolynomial(c))}))}))}static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapToSphericalPolynomial(e){const t=new s.O;let n=0;const a=2/e.size,l=a,d=.5*a,c=d-1;for(let s=0;s<6;s++){const p=this._FileFaces[s],u=e[p.name];let f=c;const m=5===e.format?4:3;for(let s=0;s<e.size;s++){let g=c;for(let l=0;l<e.size;l++){const c=p.worldAxisForFileX.scale(g).add(p.worldAxisForFileY.scale(f)).add(p.worldAxisForNormal);c.normalize();const h=this._AreaElement(g-d,f-d)-this._AreaElement(g-d,f+d)-this._AreaElement(g+d,f-d)+this._AreaElement(g+d,f+d);let w=u[s*e.size*m+l*m+0],P=u[s*e.size*m+l*m+1],E=u[s*e.size*m+l*m+2];isNaN(w)&&(w=0),isNaN(P)&&(P=0),isNaN(E)&&(E=0),0===e.type&&(w/=255,P/=255,E/=255),e.gammaSpace&&(w=Math.pow((0,r.Clamp)(w),i.tk),P=Math.pow((0,r.Clamp)(P),i.tk),E=Math.pow((0,r.Clamp)(E),i.tk));const b=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(w,P,E);if(e>b){const t=b/e;w*=t,P*=t,E*=t}}else w=(0,r.Clamp)(w,0,b),P=(0,r.Clamp)(P,0,b),E=(0,r.Clamp)(E,0,b);const S=new o.v9(w,P,E);t.addLight(c,S,h),n+=h,g+=a}f+=l}}const p=4*Math.PI*6/6/n;return t.scaleInPlace(p),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),s.Q.FromHarmonics(t)}}d._FileFaces=[new l("right",new a.Pq(1,0,0),new a.Pq(0,0,-1),new a.Pq(0,-1,0)),new l("left",new a.Pq(-1,0,0),new a.Pq(0,0,1),new a.Pq(0,-1,0)),new l("up",new a.Pq(0,1,0),new a.Pq(1,0,0),new a.Pq(0,0,1)),new l("down",new a.Pq(0,-1,0),new a.Pq(1,0,0),new a.Pq(0,0,-1)),new l("front",new a.Pq(0,0,1),new a.Pq(1,0,0),new a.Pq(0,-1,0)),new l("back",new a.Pq(0,0,-1),new a.Pq(-1,0,0),new a.Pq(0,-1,0))],d.MAX_HDRI_VALUE=4096,d.PRESERVE_CLAMPED_COLORS=!1},42683:(e,t,n)=>{n.d(t,{LO:()=>u,LZ:()=>c,Qs:()=>o,SX:()=>p});var a=n(7481),r=n(75474),s=n(30580),i=n(77891);function o(e,t,n,a,r,s,o,l){const d=t.getEngine();return t.isReady=!1,r=r??t.samplingMode,a=a??t.type,s=s??t.format,o=o??t.width,l=l??t.height,-1===a&&(a=0),new Promise((c=>{const p=new i.w("postprocess",e,null,null,1,null,r,d,!1,void 0,a,void 0,null,!1,s);p.externalTextureSamplerBinding=!0;const u=d.createRenderTargetTexture({width:o,height:l},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:r,type:a,format:s});p.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled((()=>{p.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},n.postProcessManager.directRender([p],u,!0),d.restoreDefaultFramebuffer(),d._releaseTexture(t),p&&p.dispose(),u._swapAndDie(t),t.type=a,t.format=5,t.isReady=!0,c(t)}))}))}))}let l,d;function c(e){l||(l=new Float32Array(1),d=new Int32Array(l.buffer)),l[0]=e;const t=d[0];let n=t>>16&32768,a=t>>12&2047;const r=t>>23&255;return r<103?n:r>142?(n|=31744,n|=(255==r?0:1)&&8388607&t,n):r<113?(a|=2048,n|=(a>>114-r)+(a>>113-r&1),n):(n|=r-112<<10|a>>1,n+=1&a,n)}function p(e){const t=(32768&e)>>15,n=(31744&e)>>10,a=1023&e;return 0===n?(t?-1:1)*Math.pow(2,-14)*(a/Math.pow(2,10)):31==n?a?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+a/Math.pow(2,10))}const u={CreateResizedCopy:function(e,t,n,i=!0){const o=e.getScene(),l=o.getEngine(),d=new r.$("resized"+e.name,{width:t,height:n},o,!e.noMipmap,!0,e._texture.type,!1,e.samplingMode,!1);d.wrapU=e.wrapU,d.wrapV=e.wrapV,d.uOffset=e.uOffset,d.vOffset=e.vOffset,d.uScale=e.uScale,d.vScale=e.vScale,d.uAng=e.uAng,d.vAng=e.vAng,d.wAng=e.wAng,d.coordinatesIndex=e.coordinatesIndex,d.level=e.level,d.anisotropicFilteringLevel=e.anisotropicFilteringLevel,d._texture.isReady=!1,e.wrapU=a.g.CLAMP_ADDRESSMODE,e.wrapV=a.g.CLAMP_ADDRESSMODE;const c=new s.v("pass",1,null,i?a.g.BILINEAR_SAMPLINGMODE:a.g.NEAREST_SAMPLINGMODE,l,!1,0);return c.externalTextureSamplerBinding=!0,c.onEffectCreatedObservable.addOnce((t=>{t.executeWhenCompiled((()=>{c.onApply=function(t){t.setTexture("textureSampler",e)};const t=d.renderTarget;t&&(o.postProcessManager.directRender([c],t),l.unBindFramebuffer(t),d.disposeFramebufferObjects(),c.dispose(),d.getInternalTexture().isReady=!0)}))})),d},ApplyPostProcess:o,ToHalfFloat:c,FromHalfFloat:p,GetTextureDataAsync:async function(e,t,s,o=0,l=0){return!e.isReady()&&e._texture&&await new Promise(((t,n)=>{null!==e._texture?e._texture.onLoadedObservable.addOnce((()=>{t(0)})):n(0)})),await(async(e,t,s,o,l)=>{const d=e.getScene(),c=d.getEngine();let p;if(c.isWebGPU?e.isCube?await n.e(3126).then(n.bind(n,91650)):await n.e(3126).then(n.bind(n,3613)):e.isCube?await n.e(9071).then(n.bind(n,92905)):await n.e(9071).then(n.bind(n,19278)),e.isCube){const e=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];p=new i.w("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:a.g.NEAREST_NEAREST_MIPNEAREST,engine:c,defines:e[o],shaderLanguage:c.isWebGPU?1:0})}else p=new i.w("lod","lod",{uniforms:["lod","gamma"],samplingMode:a.g.NEAREST_NEAREST_MIPNEAREST,engine:c,shaderLanguage:c.isWebGPU?1:0});await new Promise((e=>{p.onEffectCreatedObservable.addOnce((t=>{t.executeWhenCompiled((()=>{e(0)}))}))}));const u=new r.$("temp",{width:t,height:s},d,!1);p.onApply=function(t){t.setTexture("textureSampler",e),t.setFloat("lod",l),t.setInt("gamma",e.gammaSpace?1:0)};const f=e.getInternalTexture();try{if(u.renderTarget&&f){const n=f.samplingMode;0!==l?e.updateSamplingMode(a.g.NEAREST_NEAREST_MIPNEAREST):e.updateSamplingMode(a.g.NEAREST_NEAREST),d.postProcessManager.directRender([p],u.renderTarget,!0),e.updateSamplingMode(n);const r=await c.readPixels(0,0,t,s),i=new Uint8Array(r.buffer,0,r.byteLength);return c.unBindFramebuffer(u.renderTarget),i}throw Error("Render to texture failed.")}finally{u.dispose(),p.dispose()}})(e,t,s,o,l)}}},30580:(e,t,n)=>{n.d(t,{v:()=>c});var a=n(75524),r=n(77891),s=n(32206),i=n(56552),o=n(26877),l=n(50341),d=n(79259);class c extends r.w{getClassName(){return"PassPostProcess"}constructor(e,t,n=null,a,r,s,i=0,o=!1){const d={size:"number"==typeof t?t:void 0,camera:n,samplingMode:a,engine:r,reusable:s,textureType:i,blockCompilation:o,...t};super(e,l.m.FragmentUrl,{effectWrapper:"number"!=typeof t&&t.effectWrapper?void 0:new l.m(e,r,d),...d})}static _Parse(e,t,n,a){return o.p.Parse((()=>new c(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable)),e,n,a)}}(0,i.Y5)("BABYLON.PassPostProcess",c);class p extends r.w{get face(){return this._effectWrapper.face}set face(e){this._effectWrapper.face=e}getClassName(){return"PassCubePostProcess"}constructor(e,t,n=null,a,r,s,i=0,o=!1){const d={size:"number"==typeof t?t:void 0,camera:n,samplingMode:a,engine:r,reusable:s,textureType:i,blockCompilation:o,...t};super(e,l.m.FragmentUrl,{effectWrapper:"number"!=typeof t&&t.effectWrapper?void 0:new l.V(e,r,d),...d})}static _Parse(e,t,n,a){return o.p.Parse((()=>new p(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable)),e,n,a)}}(0,a.Cg)([(0,d.lK)()],p.prototype,"face",null),s.$._RescalePostProcessFactory=e=>new c("rescale",1,null,2,e,!1,0)},50341:(e,t,n)=>{n.d(t,{V:()=>i,m:()=>s});var a=n(84255),r=n(93856);class s extends a.${_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([n.e(3126).then(n.bind(n,99965))]))):t.push(Promise.all([n.e(9071).then(n.bind(n,79820))])),super._gatherImports(e,t)}constructor(e,t=null,n){super({...n,name:e,engine:t||r.N.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:s.FragmentUrl})}}s.FragmentUrl="pass";class i extends a.${_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([n.e(3126).then(n.bind(n,67682))]))):t.push(Promise.all([n.e(9071).then(n.bind(n,4511))])),super._gatherImports(e,t)}constructor(e,t=null,n){super({...n,name:e,engine:t||r.N.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:i.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}i.FragmentUrl="passCube"}}]);