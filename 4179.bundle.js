"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[4179],{84179:(e,n,t)=>{t.r(n),t.d(n,{SceneBuilder:()=>R}),t(90203),t(33832),t(2093);var o=t(8943),a=t(7839),s=t(52046),r=t(71513),i=t(18595),c=t(26041),l=t(79923),u=t(96793),w=t(58144),p=t(87491),d=t(46738),h=t(67168),f=t(2090),m=t(27744),g=t(91167),T=t(15733),b=t(26405),y=t(1592),x=t(35901),P=t(89800),q=t(32399);class R{async build(e,n){const t=new p.Z(n);t.clearColor=new c.ov(.95,.95,.95,1);const R=new a.L("arcRotateCamera",0,0,500,new l.Pq(0,0,0),t);R.minZ=1,R.maxZ=3e3,R.setPosition(new l.Pq(60,40,-50).scaleInPlace(10)),R.attachControl(void 0,!1),R.inertia=.8,R.speed=10;const S=new r.g("hemisphericLight",new l.Pq(0,1,0),t);S.intensity=.5,S.specular=new c.v9(0,0,0),S.groundColor=new c.v9(1,1,1);const I=new s.Z("directionalLight",new l.Pq(.5,-1,1),t);I.intensity=.5;I.shadowMaxZ=250,I.shadowMinZ=-250,I.autoCalcShadowZBounds=!1,I.autoUpdateExtends=!1,I.shadowOrthoScale=0,I.orthoTop=250,I.orthoBottom=-250,I.orthoLeft=-250,I.orthoRight=250;const L=new i.o(2048,I,!0);L.transparencyShadow=!0,L.usePercentageCloserFiltering=!0,L.forceBackFacesOnly=!1,L.bias=.004,L.filteringQuality=i.o.QUALITY_MEDIUM;const C=parseInt(prompt("Thread count","2"));console.log("Thread count:",C);const M=1===C?await(0,d.e)(new g.Z):await(0,d.e)(new m.t,C),v=new f.D(M),B=new T.F(v,!0),Q=new l.uq;{const e=(0,w.x)("ground",{size:500},t);e.rotationQuaternion=l.PT.RotationAxis(new l.Pq(1,0,0),Math.PI/2),L.addShadowCaster(e),e.receiveShadows=!0;const n=new b.Ty(v,new l.Pq(0,0,-1),0),o=new x.t(M);o.shape=n,l.uq.FromQuaternionToRef(e.rotationQuaternion,Q),o.setInitialTransform(Q),o.motionType=1;const a=new y.U(v,o);B.addRigidBodyToGlobal(a)}const Z=512,F=[],U=[];if("u"===prompt("Shape type (u, r) uniform box, random","u")){const e=new l.Pq(1,1,1),n=new b.SA(v,e),t={type:"box",size:e};for(let e=0;e<Z;++e)F.push(n),U.push(t)}else{const e=new q.q(0);for(let n=0;n<Z;++n){const n=2*e.next()|0;if(0===n){const n=2*e.next()+.5,t=2*e.next()+.5,o=2*e.next()+.5,a=new l.Pq(n,t,o);F.push(new b.SA(v,a)),U.push({type:"box",size:a})}else{if(1!==n)throw new Error("Invalid type");{const n=2*e.next()+1;F.push(new b.O4(v,n)),U.push({type:"sphere",radius:n})}}}}const _=[];for(let e=0;e<4;++e)for(let n=0;n<8;++n){const t=8*e+n,o=60*(n-4)+30,a=60*(e-2)+30,s=[];for(let e=0;e<Z;++e){const n=new x.t(M);n.shape=F[e];const t=l.uq.TranslationToRef(o,1+2*e,a,Q);n.setInitialTransform(t),n.friction=1,n.linearDamping=.3,n.angularDamping=.3,s.push(n)}for(let e=0;e<Z;++e){const n=s[e],o=new y.U(v,n);B.addRigidBody(o,t),_.push(o)}for(let e=0;e<Z;e+=2){const n=[t*Z+e,t*Z+e+1],o=new h.vC(v,_[n[0]],_[n[1]],l.uq.Translation(0,-1.2,0),l.uq.Translation(0,1.2,0),!0);o.setLinearLowerLimit(new l.Pq(0,0,0)),o.setLinearUpperLimit(new l.Pq(0,0,0)),o.setAngularLowerLimit(new l.Pq(Math.PI/4,0,0)),o.setAngularUpperLimit(new l.Pq(0,0,0));for(let e=0;e<6;++e)o.enableSpring(e,!0),o.setStiffness(e,100),o.setDamping(e,1);B.addConstraint(o,t,!0)}}console.log("Rigid body count:",16384);const A=[],k=(0,u.an)("baseBox",{size:1},t),z=(0,o._6X)("baseSphere",{diameter:1},t);k.setEnabled(!1),z.setEnabled(!1),k.receiveShadows=!0,z.receiveShadows=!0;for(let e=0;e<16384;++e){const n=U[e%U.length],t="box"===n.type?k.createInstance(`boxInstance${e}`):z.createInstance(`sphereInstance${e}`);L.addShadowCaster(t),t.scaling.copyFrom("box"===n.type?n.size.scale(2):new l.Pq(n.radius,n.radius,n.radius).scale(2)),t.rotationQuaternion=l.PT.Identity(),A.push(t)}return new P.X((()=>{const e=performance.now();B.stepSimulation(1/60,10,1/60);for(let e=0;e<_.length;++e){_[e].getTransformMatrixToRef(Q);const n=A[e];Q.getTranslationToRef(n.position),l.PT.FromRotationMatrixToRef(Q,n.rotationQuaternion)}const n=performance.now(),o=n-e;return t.render(),[o,performance.now()-n]})).runBench(),t.onBeforeRenderObservable.add((()=>{B.stepSimulation(1/60,10,1/60);for(let e=0;e<_.length;++e){_[e].getTransformMatrixToRef(Q);const n=A[e];Q.getTranslationToRef(n.position),l.PT.FromRotationMatrixToRef(Q,n.rotationQuaternion)}})),t}}},32399:(e,n,t)=>{t.d(n,{q:()=>o});class o{_a;constructor(e){this._a=e}next(){let e=this._a+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}}}]);