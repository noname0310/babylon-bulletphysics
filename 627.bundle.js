"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[627],{10627:(e,n,t)=>{t.r(n),t.d(n,{SceneBuilder:()=>I}),t(90203),t(61440),t(33832),t(2093);var o=t(7839),a=t(52046),s=t(71513),r=t(18595),i=t(26041),c=t(79923),l=t(96793),u=t(58144),d=t(78121),w=t(87491),p=t(46738),h=t(67168),f=t(23948),m=t(29009),b=t(27744),g=t(26405),y=t(1592),T=t(67648),q=t(35901),x=t(3477),P=t(89800),S=t(32399);class I{async build(e,n){const t=new w.Z(n);t.clearColor=new i.ov(.95,.95,.95,1);const I=new o.L("arcRotateCamera",0,0,500,new c.Pq(0,0,0),t);I.minZ=1,I.maxZ=3e3,I.setPosition(new c.Pq(60,40,-50).scaleInPlace(10)),I.attachControl(void 0,!1),I.inertia=.8,I.speed=10;const v=new s.g("hemisphericLight",new c.Pq(0,1,0),t);v.intensity=.5,v.specular=new i.v9(0,0,0),v.groundColor=new i.v9(1,1,1);const L=new a.Z("directionalLight",new c.Pq(.5,-1,1),t);L.intensity=.5;L.shadowMaxZ=250,L.shadowMinZ=-250,L.autoCalcShadowZBounds=!1,L.autoUpdateExtends=!1,L.shadowOrthoScale=0,L.orthoTop=250,L.orthoBottom=-250,L.orthoLeft=-250,L.orthoRight=250;const B=new r.o(2048,L,!0);B.transparencyShadow=!0,B.usePercentageCloserFiltering=!0,B.forceBackFacesOnly=!1,B.bias=.004,B.filteringQuality=r.o.QUALITY_MEDIUM;const C=parseInt(prompt("Thread count","2"));console.log("Thread count:",C);const R=await(0,p.e)(new b.t,C),M=new f.h(R,{allowDynamicShadow:!1,preserveBackBuffer:!1}),A=prompt("Evaluation type (i, b) immediate, buffered","i");M.evaluationType="i"===A?m.q.Immediate:m.q.Buffered;const k=new c.uq;{const e=(0,u.x)("ground",{size:500},t);e.rotationQuaternion=c.PT.RotationAxis(new c.Pq(1,0,0),Math.PI/2),B.addShadowCaster(e),e.receiveShadows=!0;const n=new g.Ty(M,new c.Pq(0,0,-1),0),o=new q.t(R);o.shape=n,c.uq.FromQuaternionToRef(e.rotationQuaternion,k),o.setInitialTransform(k),o.motionType=1;const a=new y.U(M,o);M.addRigidBodyToGlobal(a)}const Q=512,Z=[],_=[];if("u"===prompt("Shape type (u, r) uniform box, random","u")){const e=new c.Pq(1,1,1),n=new g.SA(M,e),t={type:"box",size:e};for(let e=0;e<Q;++e)Z.push(n),_.push(t)}else{const e=new S.q(0);for(let n=0;n<Q;++n){const n=2*e.next()|0;if(0===n){const n=2*e.next()+.5,t=2*e.next()+.5,o=2*e.next()+.5,a=new c.Pq(n,t,o);Z.push(new g.SA(M,a)),_.push({type:"box",size:a})}else{if(1!==n)throw new Error("Invalid type");{const n=2*e.next()+1;Z.push(new g.O4(M,n)),_.push({type:"sphere",radius:n})}}}}const E=[];for(let e=0;e<4;++e)for(let n=0;n<8;++n){const t=8*e+n,o=60*(n-4)+30,a=60*(e-2)+30,s=new x.x(R,Q);for(let e=0;e<Q;++e){s.setShape(e,Z[e]);const n=c.uq.TranslationToRef(o,1+2*e,a,k);s.setInitialTransform(e,n),s.setFriction(e,1),s.setLinearDamping(e,.3),s.setAngularDamping(e,.3)}const r=new T.Y(M,s);M.addRigidBodyBundle(r,t);for(let e=0;e<Q;e+=2){const n=[e,e+1],o=new h.vC(M,r,n,c.uq.Translation(0,-1.2,0),c.uq.Translation(0,1.2,0),!0);o.setLinearLowerLimit(new c.Pq(0,0,0)),o.setLinearUpperLimit(new c.Pq(0,0,0)),o.setAngularLowerLimit(new c.Pq(Math.PI/4,0,0)),o.setAngularUpperLimit(new c.Pq(0,0,0));for(let e=0;e<6;++e)o.enableSpring(e,!0),o.setStiffness(e,100),o.setDamping(e,1);M.addConstraint(o,t,!0)}E.push(r)}console.log("Rigid body count:",16384);const F=[],U=(0,l.an)("baseBox",{size:1},t),z=(0,d._6)("baseSphere",{diameter:1},t);U.setEnabled(!1),z.setEnabled(!1),U.receiveShadows=!0,z.receiveShadows=!0;for(let e=0;e<16384;++e){const n=_[e%_.length],t="box"===n.type?U.createInstance(`boxInstance${e}`):z.createInstance(`sphereInstance${e}`);B.addShadowCaster(t),t.scaling.copyFrom("box"===n.type?n.size.scale(2):new c.Pq(n.radius,n.radius,n.radius).scale(2)),t.rotationQuaternion=c.PT.Identity(),F.push(t)}return M.onTickObservable.add((()=>{for(let e=0;e<E.length;++e){const n=E[e];for(let t=0;t<Q;++t){n.getTransformMatrixToRef(t,k);const o=F[e*Q+t];k.getTranslationToRef(o.position),c.PT.FromRotationMatrixToRef(k,o.rotationQuaternion)}}})),new P.X((()=>{M.afterAnimations(1/60*1e3);const e=performance.now();return t.render(),[0,performance.now()-e]})).runBench(),M.register(t),t}}},32399:(e,n,t)=>{t.d(n,{q:()=>o});class o{_a;constructor(e){this._a=e}next(){let e=this._a+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}}}]);