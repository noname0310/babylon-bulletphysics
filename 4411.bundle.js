"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[4411],{2399:(e,t,n)=>{n.d(t,{q:()=>o});class o{_a;constructor(e){this._a=e}next(){let e=this._a+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}},4411:(e,t,n)=>{n.r(t),n.d(t,{SceneBuilder:()=>x}),n(203),n(1503),n(8227);var o=n(7456),a=n(5581),s=n(1513),i=n(9711),r=n(6041),c=n(9923),l=n(9899),u=n(8144),d=n(8121),p=n(554),h=n(6738),w=n(7168),m=n(3948),f=n(9009),g=n(7744),y=n(6405),P=n(1592),b=n(5901),q=n(9800),T=n(2399);class x{async build(e,t){const n=new p.Z(t);n.clearColor=new r.ov(.95,.95,.95,1);const x=new o.Lq("arcRotateCamera",0,0,500,new c.Pq(0,0,0),n);x.minZ=1,x.maxZ=3e3,x.setPosition(new c.Pq(60,40,-50).scaleInPlace(10)),x.attachControl(void 0,!1),x.inertia=.8,x.speed=10;const S=new s.g("hemisphericLight",new c.Pq(0,1,0),n);S.intensity=.5,S.specular=new r.v9(0,0,0),S.groundColor=new r.v9(1,1,1);const I=new a.Z("directionalLight",new c.Pq(.5,-1,1),n);I.intensity=.5;I.shadowMaxZ=250,I.shadowMinZ=-250,I.autoCalcShadowZBounds=!1,I.autoUpdateExtends=!1,I.shadowOrthoScale=0,I.orthoTop=250,I.orthoBottom=-250,I.orthoLeft=-250,I.orthoRight=250;const v=new i.o(2048,I,!0);v.transparencyShadow=!0,v.usePercentageCloserFiltering=!0,v.forceBackFacesOnly=!1,v.bias=.004,v.filteringQuality=i.o.QUALITY_MEDIUM;const C=parseInt(prompt("Thread count","2"));console.log("Thread count:",C);const L=await(0,h.e)(new g.t,C),R=new m.h(L,{allowDynamicShadow:!1,preserveBackBuffer:!1}),B=prompt("Evaluation type (i, b) immediate, buffered","i");R.evaluationType="i"===B?f.q.Immediate:f.q.Buffered;const M=new c.uq;{const e=(0,u.x)("ground",{size:500},n);e.rotationQuaternion=c.PT.RotationAxis(new c.Pq(1,0,0),Math.PI/2),v.addShadowCaster(e),e.receiveShadows=!0;const t=new y.Ty(R,new c.Pq(0,0,-1),0),o=new b.t(L);o.shape=t,c.uq.FromQuaternionToRef(e.rotationQuaternion,M),o.setInitialTransform(M),o.motionType=1;const a=new P.U(R,o);R.addRigidBodyToGlobal(a)}const O=512,U=[],_=[];if("u"===prompt("Shape type (u, r) uniform box, random","u")){const e=new c.Pq(1,1,1),t=new y.SA(R,e),n={type:"box",size:e};for(let e=0;e<O;++e)U.push(t),_.push(n)}else{const e=new T.q(0);for(let t=0;t<O;++t){const t=2*e.next()|0;if(0===t){const t=2*e.next()+.5,n=2*e.next()+.5,o=2*e.next()+.5,a=new c.Pq(t,n,o);U.push(new y.SA(R,a)),_.push({type:"box",size:a})}else{if(1!==t)throw new Error("Invalid type");{const t=2*e.next()+1;U.push(new y.O4(R,t)),_.push({type:"sphere",radius:t})}}}}const Z=[];for(let e=0;e<4;++e)for(let t=0;t<8;++t){const n=8*e+t,o=60*(t-4)+30,a=60*(e-2)+30,s=[];for(let e=0;e<O;++e){const t=new b.t(L);t.shape=U[e];const n=c.uq.TranslationToRef(o,1+2*e,a,M);t.setInitialTransform(n),t.friction=1,t.linearDamping=.3,t.angularDamping=.3,s.push(t)}for(let e=0;e<O;++e){const t=s[e],o=new P.U(R,t);R.addRigidBody(o,n),Z.push(o)}for(let e=0;e<O;e+=2){const t=[n*O+e,n*O+e+1],o=new w.vC(R,Z[t[0]],Z[t[1]],c.uq.Translation(0,-1.2,0),c.uq.Translation(0,1.2,0),!0);o.setLinearLowerLimit(new c.Pq(0,0,0)),o.setLinearUpperLimit(new c.Pq(0,0,0)),o.setAngularLowerLimit(new c.Pq(Math.PI/4,0,0)),o.setAngularUpperLimit(new c.Pq(0,0,0));for(let e=0;e<6;++e)o.enableSpring(e,!0),o.setStiffness(e,100),o.setDamping(e,1);R.addConstraint(o,n,!0)}}console.log("Rigid body count:",16384);const k=[],z=(0,l.an)("baseBox",{size:1},n),A=(0,d._6)("baseSphere",{diameter:1},n);z.setEnabled(!1),A.setEnabled(!1),z.receiveShadows=!0,A.receiveShadows=!0;for(let e=0;e<16384;++e){const t=_[e%_.length],n="box"===t.type?z.createInstance(`boxInstance${e}`):A.createInstance(`sphereInstance${e}`);v.addShadowCaster(n),n.scaling.copyFrom("box"===t.type?t.size.scale(2):new c.Pq(t.radius,t.radius,t.radius).scale(2)),n.rotationQuaternion=c.PT.Identity(),k.push(n)}return R.onTickObservable.add((()=>{for(let e=0;e<Z.length;++e){Z[e].getTransformMatrixToRef(M);const t=k[e];M.getTranslationToRef(t.position),c.PT.FromRotationMatrixToRef(M,t.rotationQuaternion)}})),new q.X((()=>{const e=R.afterAnimations(1/60*1e3),t=performance.now();return n.render(),[e,performance.now()-t]})).runBench(),R.register(n),n}}},8121:(e,t,n)=>{n.d(t,{_6:()=>c});var o=n(9923),a=n(1812),s=n(6803),i=n(1313);function r(e){const t=0|(e.segments||32),n=e.diameterX||e.diameter||1,a=e.diameterY||e.diameter||1,r=e.diameterZ||e.diameter||1,c=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,l=e.slice&&e.slice<=0?1:e.slice||1,u=0===e.sideOrientation?0:e.sideOrientation||s.P.DEFAULTSIDE,d=!!e.dedupTopBottomIndices,p=new o.Pq(n/2,a/2,r/2),h=2+t,w=2*h,m=[],f=[],g=[],y=[];for(let e=0;e<=h;e++){const t=e/h,n=t*Math.PI*l;for(let e=0;e<=w;e++){const a=e/w,s=a*Math.PI*2*c,r=o.uq.RotationZ(-n),l=o.uq.RotationY(s),u=o.Pq.TransformCoordinates(o.Pq.Up(),r),d=o.Pq.TransformCoordinates(u,l),h=d.multiply(p),m=d.divide(p).normalize();f.push(h.x,h.y,h.z),g.push(m.x,m.y,m.z),y.push(a,i.rX?1-t:t)}if(e>0){const t=f.length/3;for(let n=t-2*(w+1);n+w+2<t;n++)d?(e>1&&(m.push(n),m.push(n+1),m.push(n+w+1)),(e<h||l<1)&&(m.push(n+w+1),m.push(n+1),m.push(n+w+2))):(m.push(n),m.push(n+1),m.push(n+w+1),m.push(n+w+1),m.push(n+1),m.push(n+w+2))}}s.P._ComputeSides(u,f,m,g,y,e.frontUVs,e.backUVs);const P=new s.P;return P.indices=m,P.positions=f,P.normals=g,P.uvs=y,P}function c(e,t={},n=null){const o=new a.e(e,n);return t.sideOrientation=a.e._GetDefaultSideOrientation(t.sideOrientation),o._originalBuilderSideOrientation=t.sideOrientation,r(t).applyToMesh(o,t.updatable),o}s.P.CreateSphere=r,a.e.CreateSphere=(e,t,n,o,a,s)=>c(e,{segments:t,diameterX:n,diameterY:n,diameterZ:n,sideOrientation:s,updatable:a},o)}}]);