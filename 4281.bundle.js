"use strict";(self.webpackChunkbabylon_bulletphysics=self.webpackChunkbabylon_bulletphysics||[]).push([[4281],{14281:(e,n,t)=>{t.r(n),t.d(n,{SceneBuilder:()=>L}),t(90203),t(33832),t(2093);var o=t(7839),a=t(52046),s=t(71513),i=t(18595),r=t(26041),c=t(79923),l=t(96793),w=t(58144),d=t(87491),u=t(46738),h=t(67168),p=t(25203),f=t(29009),g=t(27744),m=t(26405),y=t(1592),q=t(67648),P=t(35901),T=t(3477),b=t(89800);class L{async build(e,n){const t=new d.Z(n);t.clearColor=new r.ov(.95,.95,.95,1);const L=new o.L("arcRotateCamera",0,0,500,new c.Pq(0,0,0),t);L.minZ=1,L.maxZ=3e3,L.setPosition(new c.Pq(60,40,-50).scaleInPlace(10)),L.attachControl(void 0,!1),L.inertia=.8,L.speed=10;const C=new s.g("hemisphericLight",new c.Pq(0,1,0),t);C.intensity=.5,C.specular=new r.v9(0,0,0),C.groundColor=new r.v9(1,1,1);const S=new a.Z("directionalLight",new c.Pq(.5,-1,1),t);S.intensity=.5;S.shadowMaxZ=250,S.shadowMinZ=-250,S.autoCalcShadowZBounds=!1,S.autoUpdateExtends=!1,S.shadowOrthoScale=0,S.orthoTop=250,S.orthoBottom=-250,S.orthoLeft=-250,S.orthoRight=250;const v=new i.o(2048,S,!0);v.transparencyShadow=!0,v.usePercentageCloserFiltering=!0,v.forceBackFacesOnly=!1,v.bias=.004,v.filteringQuality=i.o.QUALITY_MEDIUM;const B=await(0,u.e)(new g.t,4),I=new p.w(B);I.evaluationType=f.q.Immediate;const x=new c.uq;{const e=(0,w.x)("ground",{size:500},t);e.rotationQuaternion=c.PT.RotationAxis(new c.Pq(1,0,0),Math.PI/2),v.addShadowCaster(e),e.receiveShadows=!0;const n=new m.Ty(I,new c.Pq(0,0,-1),0),o=new P.t(B);o.shape=n,c.uq.FromQuaternionToRef(e.rotationQuaternion,x),o.setInitialTransform(x),o.motionType=1;const a=new y.U(I,o);I.addRigidBody(a)}const A=512,R=(0,l.an)("box",{size:2},t);v.addShadowCaster(R),R.receiveShadows=!0;const M=new Float32Array(32768);R.thinInstanceSetBuffer("matrix",M,16,!1);const U=new m.SA(I,new c.Pq(1,1,1)),Z=[];for(let e=0;e<2;++e)for(let n=0;n<2;++n){const t=20*(n-1)+10,o=20*(e-1)+10,a=new T.x(B,A);for(let e=0;e<A;++e){a.setShape(e,U);const n=c.uq.TranslationToRef(t,1+2*e,o,x);a.setInitialTransform(e,n),a.setFriction(e,1),a.setLinearDamping(e,.3),a.setAngularDamping(e,.3)}const s=new q.Y(I,a);I.addRigidBodyBundle(s);for(let e=0;e<A;e+=2){const n=[e,e+1],t=new h.vC(I,s,n,c.uq.Translation(0,-1.2,0),c.uq.Translation(0,1.2,0),!0);t.setLinearLowerLimit(new c.Pq(0,0,0)),t.setLinearUpperLimit(new c.Pq(0,0,0)),t.setAngularLowerLimit(new c.Pq(Math.PI/4,0,0)),t.setAngularUpperLimit(new c.Pq(0,0,0));for(let e=0;e<6;++e)t.enableSpring(e,!0),t.setStiffness(e,100),t.setDamping(e,1);I.addConstraint(t,!1)}Z.push(s)}console.log("Rigid body count:",2048),I.onTickObservable.add((()=>{for(let e=0;e<Z.length;++e)Z[e].getTransformMatricesToArray(M,e*A*16);R.thinInstanceBufferUpdated("matrix")}));const k=new b.X((()=>{I.afterAnimations(1/60*1e3),t.render()}));return k.sampleCount=5e3,k.runBench(),I.register(t),t}}}}]);